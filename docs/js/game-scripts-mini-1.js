(function(e,t,n){function Y(){arguments.length==1?(this.x=arguments[0].x,this.y=arguments[0].y):(this.x=arguments[0],this.y=arguments[1])}var r=qc.defineBehaviour("qc.TweenFunction",qc.Tween,function(){var e=this;e.funcName="",e.func=null,e.funcContext=null,e.enable=!1},{funcName:qc.Serializer.STRING});r.__menu="Plugins/TweenFunction",t.defineProperties(r.prototype,{funcName:{get:function(){return this._funcName},set:function(e){if(e===this._funcName)return;this._funcName=e,this.onEnable()}}}),r.prototype.onEnable=function(){if(this._funcName.length<=0)return;this.func=this.gameObject[this._funcName];var t=[];this.func&&(t.push(this.gameObject.class),this.func=this.func.bind(this.gameObject));var n=this;this.gameObject.scripts.forEach(function(e){var r=e[n._funcName];r&&(t.push(e.class),n.func=r.bind(e))}),!n.func&&this.enable&&this.game.log.important("TweenFunction({0}) not find!",this._funcName);if(t.length<=1)return;n.game.log.error("Error: Exist multi functions with same name: {0}",t);if(n.game.device.editor===!0){var r=e.parent&&e.parent.G;if(r){var i=r._("TweenFunction func error")+t;r.notification.error(i)}}},r.prototype.onUpdate=function(e,t){if(typeof this.func!="function")return;if(this.duration==0&&!t)return;this.func(e,this.duration)},r.begin=function(e,t,n){var r=qc.Tween.begin("qc.TweenFunction",e,t);return r.funcName=n,r};var i=Phaser.Physics.Arcade=function(e){this.game=e,this.gravity=new Phaser.Point,this.bounds=new Phaser.Rectangle(0,0,e.world.width,e.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=10,this.forceX=!1,this.sortDirection=Phaser.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new Phaser.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()};i.prototype={},i.prototype.constructor=i,i.SORT_NONE=0,i.LEFT_RIGHT=1,i.RIGHT_LEFT=2,i.TOP_BOTTOM=3,i.BOTTOM_TOP=4,i.prototype.gatherBody=function(e,t){e.body&&t.push(e.body);var n=e.children;if(n)for(var r=0,i=n.length;r<i;r++)this.gatherBody(n[r],t)},i.prototype.preUpdate=function(){var e=this.game,t=[];this.gatherBody(this.game.world,t);var n,r=t.length,i,s;for(n=0;n<r;n++)t[n].preUpdate();for(n=0;n<r;n++){s=t[n].qc;if(!s)continue;i=t[n].qc.getScript("qc.arcade.RigidBody"),i&&i.updateRigidbody()}for(n=0;n<r;n++)t[n].postUpdate()},i.prototype.setBounds=function(e,t,n,r){this.bounds.setTo(e,t,n,r)},i.prototype.setBoundsToWorld=function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},i.prototype.enable=function(e,t){typeof t=="undefined"&&(t=!0);var n=1;if(Array.isArray(e)){n=e.length;while(n--)e[n]instanceof Phaser.Group?this.enable(e[n].children,t):(this.enableBody(e[n]),t&&e[n].hasOwnProperty("children")&&e[n].children.length>0&&this.enable(e[n],!0))}else e instanceof Phaser.Group?this.enable(e.children,t):(this.enableBody(e),t&&e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children,!0))},i.prototype.enableBody=function(e){e.hasOwnProperty("body")&&e.body===null&&(e.body=new Phaser.Physics.Arcade.Body(e))},i.prototype.updateMotion=function(e){var t=this.computeVelocity(0,e,e.angularVelocity,e.angularAcceleration,e.angularDrag,e.maxAngular)-e.angularVelocity;e.angularVelocity+=t,e.rotation+=e.angularVelocity*this.game.time.physicsElapsed,e.velocity.x=this.computeVelocity(1,e,e.velocity.x,e.acceleration.x,e.drag.x,e.maxVelocity.x),e.velocity.y=this.computeVelocity(2,e,e.velocity.y,e.acceleration.y,e.drag.y,e.maxVelocity.y)},i.prototype.computeVelocity=function(e,t,n,r,i,s){return typeof s=="undefined"&&(s=1e4),e===1&&t.allowGravity?n+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:e===2&&t.allowGravity&&(n+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?n+=r*this.game.time.physicsElapsed:i&&(i*=this.game.time.physicsElapsed,n-i>0?n-=i:n+i<0?n+=i:n=0),n>s?n=s:n<-s&&(n=-s),n},i.prototype.overlap=function(e,t,n,r,i){n=n||null,r=r||null,i=i||n,this._total=0;if(!Array.isArray(e)&&Array.isArray(t))for(var s=0;s<t.length;s++)this.collideHandler(e,t[s],n,r,i,!0);else if(Array.isArray(e)&&!Array.isArray(t))for(var s=0;s<e.length;s++)this.collideHandler(e[s],t,n,r,i,!0);else if(Array.isArray(e)&&Array.isArray(t))for(var s=0;s<e.length;s++)for(var o=0;o<t.length;o++)this.collideHandler(e[s],t[o],n,r,i,!0);else this.collideHandler(e,t,n,r,i,!0);return this._total>0},i.prototype.collide=function(e,t,n,r,i){n=n||null,r=r||null,i=i||n,this._total=0;if(!Array.isArray(e)&&Array.isArray(t))for(var s=0;s<t.length;s++)this.collideHandler(e,t[s],n,r,i,!1);else if(Array.isArray(e)&&!Array.isArray(t))for(var s=0;s<e.length;s++)this.collideHandler(e[s],t,n,r,i,!1);else if(Array.isArray(e)&&Array.isArray(t))for(var s=0;s<e.length;s++)for(var o=0;o<t.length;o++)this.collideHandler(e[s],t[o],n,r,i,!1);else this.collideHandler(e,t,n,r,i,!1);return this._total>0},i.prototype.sort=function(e){this.sortDirection===Phaser.Physics.Arcade.LEFT_RIGHT?e._hash.sort(function(e,t){return!e.body||!t.body?-1:e.body.x-t.body.x}):this.sortDirection===Phaser.Physics.Arcade.RIGHT_LEFT?e._hash.sort(function(e,t){return!e.body||!t.body?-1:t.body.x-e.body.x}):this.sortDirection===Phaser.Physics.Arcade.TOP_BOTTOM?e._hash.sort(function(e,t){return!e.body||!t.body?-1:e.body.y-t.body.y}):this.sortDirection===Phaser.Physics.Arcade.BOTTOM_TOP&&e._hash.sort(function(e,t){return!e.body||!t.body?-1:t.body.y-e.body.y})},i.prototype.collideHandler=function(e,t,n,r,i,s){if(!e||!t||!e.exists||!t.exists)return;this.sortDirection!==Phaser.Physics.Arcade.SORT_NONE&&(e.physicsType===Phaser.GROUP&&this.sort(e),t.physicsType===Phaser.GROUP&&this.sort(t)),this.collideSpriteVsSprite(e,t,n,r,i,s)},i.prototype.collideSpriteVsSprite=function(e,t,n,r,i,s){return!e.body||!t.body?!1:(this.separate(e.body,t.body,r,i,s)&&(n&&n.call(i,e,t),this._total++),!0)},i.prototype.separate=function(e,t,n,r,i){if(!e.enable||!t.enable||!this.intersects(e,t))return!1;if(n&&n.call(r,e.sprite,t.sprite)===!1)return!1;var s=!1;return this.forceX||Math.abs(this.gravity.y+e.gravity.y)<Math.abs(this.gravity.x+e.gravity.x)?s=this.separateX(e,t,i)||this.separateY(e,t,i):s=this.separateY(e,t,i)||this.separateX(e,t,i),i?!0:s},i.prototype.intersects=function(e,t){var n=Math.max(e.ccdIterations,t.ccdIterations);if(n<=0)return!(e.right<=t.x||e.bottom<=t.y||e.x>=t.right||e.y>=t.bottom);var r=e._dx/(n+2),i=t._dx/(n+2),s=e._dy/(n+2),o=t._dy/(n+2),u=Array(n+1),a=Array(n+1);u[n]=[e.x,e.right,e.y,e.bottom],a[n]=[t.x,t.right,t.y,t.bottom];for(var f=n-1;f>=0;f--)u[f]=[u[f+1][0]-r,u[f+1][1]-r,u[f+1][2]-s,u[f+1][3]-s];for(f=n-1;f>=0;f--)a[f]=[a[f+1][0]-i,a[f+1][1]-i,a[f+1][2]-o,a[f+1][3]-o];for(f=0;f<=n;f++){if(u[f][1]<=a[f][0]||u[f][3]<=a[f][2]||u[f][0]>=a[f][1]||u[f][2]>=a[f][3])continue;return e.x=u[f][0],e.y=u[f][2],t.x=a[f][0],t.y=a[f][2],!0}return!1},i.prototype.separateX=function(e,t,n){if(e.immovable&&t.immovable)return!1;var r=0;if(this.intersects(e,t)){var i=e.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS;e.deltaX()===0&&t.deltaX()===0?(e.embedded=!0,t.embedded=!0):e.deltaX()>t.deltaX()?(r=e.right-t.x,r>i||e.checkCollision.right===!1||t.checkCollision.left===!1?r=0:(e.touching.none=!1,e.touching.right=!0,t.touching.none=!1,t.touching.left=!0)):e.deltaX()<t.deltaX()&&(r=e.x-t.width-t.x,-r>i||e.checkCollision.left===!1||t.checkCollision.right===!1?r=0:(e.touching.none=!1,e.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),e.overlapX=r,t.overlapX=r;if(r!==0){if(n||e.customSeparateX||t.customSeparateX)return!0;var s=e.velocity.x,o=t.velocity.x;if(!e.immovable&&!t.immovable){r*=.5,e.x-=r,t.x+=r;var u=Math.sqrt(o*o*t.mass/e.mass)*(o>0?1:-1),a=Math.sqrt(s*s*e.mass/t.mass)*(s>0?1:-1),f=(u+a)*.5;u-=f,a-=f,e.velocity.x=f+u*e.bounce.x,t.velocity.x=f+a*t.bounce.x}else e.immovable?t.immovable||(t.x+=r,t.velocity.x=s-o*t.bounce.x,e.moves&&(t.y+=(e.y-e.prevY)*e.friction.y)):(e.x-=r,e.velocity.x=o-s*e.bounce.x,t.moves&&(e.y+=(t.y-t.prevY)*t.friction.y));return!0}}return!1},i.prototype.separateY=function(e,t,n){if(e.immovable&&t.immovable)return!1;var r=0;if(this.intersects(e,t)){var i=e.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS;e.deltaY()===0&&t.deltaY()===0?(e.embedded=!0,t.embedded=!0):e.deltaY()>t.deltaY()?(r=e.bottom-t.y,r>i||e.checkCollision.down===!1||t.checkCollision.up===!1?r=0:(e.touching.none=!1,e.touching.down=!0,t.touching.none=!1,t.touching.up=!0)):e.deltaY()<t.deltaY()&&(r=e.y-t.bottom,-r>i||e.checkCollision.up===!1||t.checkCollision.down===!1?r=0:(e.touching.none=!1,e.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),e.overlapY=r,t.overlapY=r;if(r!==0){if(n||e.customSeparateY||t.customSeparateY)return!0;var s=e.velocity.y,o=t.velocity.y;if(!e.immovable&&!t.immovable){r*=.5,e.y-=r,t.y+=r;var u=Math.sqrt(o*o*t.mass/e.mass)*(o>0?1:-1),a=Math.sqrt(s*s*e.mass/t.mass)*(s>0?1:-1),f=(u+a)*.5;u-=f,a-=f,e.velocity.y=f+u*e.bounce.y,t.velocity.y=f+a*t.bounce.y}else e.immovable?t.immovable||(t.y+=r,t.velocity.y=s-o*t.bounce.y,e.moves&&(t.x+=(e.x-e.prevX)*e.friction.x)):(e.y-=r,e.velocity.y=o-s*e.bounce.y,t.moves&&(e.x+=(t.x-t.prevX)*t.friction.x));return!0}}return!1},i.prototype.moveToObject=function(e,t,n,r){typeof n=="undefined"&&(n=60),typeof r=="undefined"&&(r=0);var i=Math.atan2(t.y-e.y,t.x-e.x);return r>0&&(n=this.distanceBetween(e,t)/(r/1e3)),e.body.velocity.x=Math.cos(i)*n,e.body.velocity.y=Math.sin(i)*n,i},i.prototype.velocityFromAngle=function(e,t,n){return typeof t=="undefined"&&(t=60),n=n||new Phaser.Point,n.setTo(Math.cos(this.game.math.degToRad(e))*t,Math.sin(this.game.math.degToRad(e))*t)},i.prototype.velocityFromRotation=function(e,t,n){return typeof t=="undefined"&&(t=60),n=n||new Phaser.Point,n.setTo(Math.cos(e)*t,Math.sin(e)*t)},i.prototype.accelerateToObject=function(e,t,n,r,i){typeof n=="undefined"&&(n=60),typeof r=="undefined"&&(r=1e3),typeof i=="undefined"&&(i=1e3);var s=this.angleBetween(e,t);return e.body.acceleration.setTo(Math.cos(s)*n,Math.sin(s)*n),e.body.maxVelocity.setTo(r,i),s},i.prototype.distanceBetween=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},i.prototype.angleBetween=function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.atan2(r,n)},Phaser.Physics.Arcade.Body=function(e){this.sprite=e,this.qc=e._qc,this.game=e.game,this.type=Phaser.Physics.ARCADE,this.enable=!0,this.x=e.world.x,this.prevX=this.x,this.y=e.world.y,this.prevY=this.y,this.width=e.width,this.height=e.height,this.allowRotation=!0,this.rotation=e.rotation,this.preRotation=e.rotation,this.gravity=new Phaser.Point(0,0),this.ccdIterations=0,this.velocity=new Phaser.Point,this.newVelocity=new Phaser.Point(0,0),this.deltaMax=new Phaser.Point(0,0),this.acceleration=new Phaser.Point,this.drag=new Phaser.Point,this.allowGravity=!0,this.bounce=new Phaser.Point,this.maxVelocity=new Phaser.Point(1e4,1e4),this.friction=new Phaser.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=Phaser.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.dirty=!1,this._reset=!0,this._sx=e.scale.x,this._spx=this._sx,this._sy=e.scale.y,this._spy=this._sy,this._dx=0,this._dy=0};var s=Phaser.Physics.Arcade.Body;s.prototype={},s.prototype.constructor=s,t.defineProperties(s.prototype,{right:{get:function(){return this.x+this.width}},bottom:{get:function(){return this.y+this.height}}}),s.prototype.updateBounds=function(e){var t=this.qc.worldTransform,n=t.a,r=t.d,i=this.qc.parent.worldTransform;this._spx=i.a,this._spy=i.d;if(e||n!==this._sx||r!==this._sy)this._sx=n,this._sy=r,this.width=Math.abs(n*this.qc._width),this.height=Math.abs(r*this.qc._height),this._reset=!0},s.prototype.preUpdate=function(){if(!this.enable||this.game.physics.arcade.isPaused)return;this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this._sx>=0?this.x=this.sprite.world.x-this.sprite.anchor.x*this.width:this.x=this.sprite.world.x-(1-this.sprite.anchor.x)*this.width,this._sy>=0?this.y=this.sprite.world.y-this.sprite.anchor.y*this.height:this.y=this.sprite.world.y-(1-this.sprite.anchor.y)*this.height,this.rotation=this.sprite.angle,this.preRotation=this.rotation;if(this._reset||this.sprite.fresh)this.prevX=this.x,this.prevY=this.y;if(this.moves){this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.x+=this.newVelocity.x*this._spx,this.y+=this.newVelocity.y*this._spy;if(this.x!==this.prevX||this.y!==this.prevY)this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x);this.collideWorldBounds&&this.checkWorldBounds()}this._dx=this.x-this.prevX,this._dy=this.y-this.prevY,this._reset=!1},s.prototype.postUpdate=function(){if(!this.enable||!this.dirty)return;this.dirty=!1;var e=this.x-this.prevX,t=this.y-this.prevY;e<0?this.facing=Phaser.LEFT:e>0&&(this.facing=Phaser.RIGHT),t<0?this.facing=Phaser.UP:t>0&&(this.facing=Phaser.DOWN),this.moves&&(this._dx=e,this._dy=t,this.deltaMax.x!==0&&this._dx!==0&&(this._dx<0&&this._dx<-this.deltaMax.x?(this._dx=-this.deltaMax.x,this.x=this._dx+this.prevX):this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x,this.x=this._dx+this.prevX)),this.deltaMax.y!==0&&this._dy!==0&&(this._dy<0&&this._dy<-this.deltaMax.y?(this._dy=-this.deltaMax.y,this.y=this._dy+this.prevY):this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y,this.y=this._dy+this.prevY)),this._dx!==0&&(this.qc.x+=this._dx/this._spx),this._dy!==0&&(this.qc.y+=this._dy/this._spy),this._reset=!0),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prevX=this.x,this.prevY=this.y},s.prototype.destroy=function(){this.sprite.body=null,this.sprite=null,this.qc=null},s.prototype.checkWorldBounds=function(){if(this.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left&&this._dx<0){var e=this.sprite._qc;this.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0}else if(this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&this._dx>0){var e=this.sprite._qc;this.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0}if(this.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up&&this._dy<0){var e=this.sprite._qc;this.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0}else if(this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&this._dy>0){var e=this.sprite._qc;this.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0}},s.prototype.reset=function(e,t){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this._reset=!0},s.prototype.onFloor=function(){return this.blocked.down},s.prototype.onWall=function(){return this.blocked.left||this.blocked.right},s.prototype.deltaAbsX=function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},s.prototype.deltaAbsY=function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},s.prototype.deltaX=function(){return this.x-this.prevX},s.prototype.deltaY=function(){return this.y-this.prevY},s.prototype.deltaZ=function(){return this.rotation-this.preRotation};var o=qc.defineBehaviour("qc.arcade.RigidBody",qc.Behaviour,function(){var e=this;e.arcade=e.game.phaser.physics.arcade,e.phaser=e.gameObject.phaser,e._collide=[],e._overlap=[];if(!(e.gameObject instanceof qc.Sprite||e.gameObject instanceof qc.UIImage))throw new Error("Only Sprite or UIImage can attack RigidBody!");e.phaser.enableBody=!1,e.phaser.physicsBodyType=Phaser.Physics.ARCADE,e.arcade.enable(e.phaser,!1),e.phaser.body.enable=!1,e.phaser.body._qc=e},function(){return{mass:qc.Serializer.NUMBER,collideWorldBounds:qc.Serializer.BOOLEAN,allowRotation:qc.Serializer.BOOLEAN,allowGravity:qc.Serializer.BOOLEAN,velocity:qc.Serializer.POINT,maxVelocity:qc.Serializer.POINT,acceleration:qc.Serializer.POINT,drag:qc.Serializer.POINT,gravity:qc.Serializer.POINT,friction:qc.Serializer.POINT,angularVelocity:qc.Serializer.NUMBER,maxAngular:qc.Serializer.NUMBER,angularAcceleration:qc.Serializer.NUMBER,angularDrag:qc.Serializer.NUMBER,bounce:qc.Serializer.POINT,immovable:qc.Serializer.BOOLEAN,moves:qc.Serializer.BOOLEAN,checkCollision:qc.Serializer.MAPPING,tilePadding:qc.Serializer.POINT,collides:qc.Serializer.NODES,overlaps:qc.Serializer.NODES,ccdIterations:qc.Serializer.INT}});o.__menu="Plugins/Arcade/RigidBody",t.defineProperties(o.prototype,{mass:{get:function(){return this.phaser.body.mass},set:function(e){this.phaser.body.mass=e}},collideWorldBounds:{get:function(){return this.phaser.body.collideWorldBounds},set:function(e){this.phaser.body.collideWorldBounds=e}},allowRotation:{get:function(){return this.phaser.body.allowRotation},set:function(e){this.phaser.body.allowRotation=e}},allowGravity:{get:function(){return this.phaser.body.allowGravity},set:function(e){this.phaser.body.allowGravity=e}},velocity:{get:function(){return this.phaser.body.velocity},set:function(e){this.phaser.body.velocity=e}},maxVelocity:{get:function(){return this.phaser.body.maxVelocity},set:function(e){this.phaser.body.maxVelocity=e}},angularAcceleration:{get:function(){return this.phaser.body.angularAcceleration},set:function(e){this.phaser.body.angularAcceleration=e,this.gameObject._isTransformDirty=!0}},acceleration:{get:function(){return this.phaser.body.acceleration},set:function(e){this.phaser.body.acceleration=e}},drag:{get:function(){return this.phaser.body.drag},set:function(e){this.phaser.body.drag=e}},gravity:{get:function(){return this.phaser.body.gravity},set:function(e){this.phaser.body.gravity=e,this.gameObject._isTransformDirty=!0}},bounce:{get:function(){return this.phaser.body.bounce},set:function(e){this.phaser.body.bounce=e,this.gameObject._isTransformDirty=!0}},friction:{get:function(){return this.phaser.body.friction},set:function(e){this.phaser.body.friction=e,this.gameObject._isTransformDirty=!0}},angularVelocity:{get:function(){return this.phaser.body.angularVelocity},set:function(e){this.phaser.body.angularVelocity=e,this.gameObject._isTransformDirty=!0}},angularDrag:{get:function(){return this.phaser.body.angularDrag},set:function(e){this.phaser.body.angularDrag=e,this.gameObject._isTransformDirty=!0}},maxAngular:{get:function(){return this.phaser.body.maxAngular},set:function(e){this.phaser.body.maxAngular=e}},angle:{get:function(){return this.phaser.body.angle}},speed:{get:function(){return this.phaser.body.speed}},immovable:{get:function(){return this.phaser.body.immovable},set:function(e){this.phaser.body.immovable=e}},moves:{get:function(){return this.phaser.body.moves},set:function(e){this.phaser.body.moves=e,this.gameObject._isTransformDirty=!0}},overlapX:{get:function(){return this.phaser.body.overlapX}},overlapY:{get:function(){return this.phaser.body.overlapY}},embedded:{get:function(){return this.phaser.body.embedded},set:function(e){this.phaser.body.embedded=e}},checkCollision:{get:function(){return this.phaser.body.checkCollision},set:function(e){this.phaser.body.checkCollision=e}},touching:{get:function(){return this.phaser.body.touching}},wasTouching:{get:function(){return this.phaser.body.wasTouching}},blocked:{get:function(){return this.phaser.body.blocked},set:function(e){this.phaser.body.blocked=e}},tilePadding:{get:function(){return this.phaser.body.tilePadding},set:function(e){this.phaser.body.tilePadding=e}},onFloor:{get:function(){return this.phaser.body.onFloor()}},onWall:{get:function(){return this.phaser.body.onWall()}},deltaX:{get:function(){return this.phaser.body.deltaX()}},deltaY:{get:function(){return this.phaser.body.deltaY()}},deltaZ:{get:function(){return this.phaser.body.deltaZ()}},collides:{get:function(){return this._collide},set:function(e){this._collide=e}},overlaps:{get:function(){return this._overlap},set:function(e){this._overlap=e}},ccdIterations:{get:function(){return this.phaser.body.ccdIterations},set:function(e){this.phaser.body.ccdIterations=e}}}),o.prototype.awake=function(){var e=this.phaser.body;e.updateBounds(!0)},o.prototype.onEnable=function(){var e=this;e.phaser.enableBody=!0,e.phaser.body.enable=!0},o.prototype.onDisable=function(){var e=this;e.phaser.enableBody=!1,e.phaser.body.enable=!1},o.prototype.updateRigidbody=function(){var e=this;for(var t=0;t<e._collide.length;t++){var r=e._collide[t];if(!r||r._destroy)continue;e.arcade.collide(e.phaser,r.phaser,e._collideCallback,n,e)}for(var t=0;t<e._overlap.length;t++){var r=e._overlap[t];if(!r||r._destroy)continue;e.arcade.overlap(e.phaser,r.phaser,e._overlapCallback,n,e)}},o.prototype.reset=function(){this._collide=[],this._overlap=[],this.phaser.body.reset(this.gameObject.x,this.gameObject.y)},o.prototype.addCollide=function(e){this._collide.indexOf(e)===-1&&this._collide.push(e)},o.prototype.removeCollide=function(e){var t=this._collide.indexOf(e);t!==-1&&this._collide.splice(t,1)},o.prototype.addOverlap=function(e){this._overlap.indexOf(e)===-1&&this._overlap.push(e)},o.prototype.removeOverlap=function(e){var t=this._overlap.indexOf(e);t!==-1&&this._overlap.splice(t,1)},o.prototype.moveToObject=function(e,t,n){return this.arcade.moveToObject(this.phaser,e,t,n)},o.prototype.velocityFromAngle=function(e,t,n){return this.arcade.velocityFromAngle(e,t,n)},o.prototype.velocityFromRotation=function(e,t,n){return this.arcade.velocityFromRotation(e,t,n)},o.prototype.accelerateToObject=function(e,t,n,r){return this.arcade.accelerateToObject(this.phaser,e,t,n,r)},o.prototype.distanceBetween=function(e){return this.arcade.distanceBetween(this.phaser,e)},o.prototype.angleBetween=function(e){return this.arcade.angleBetween(this.phaser,e)},o.prototype._collideCallback=function(e,t){this.gameObject._sendMessage("onCollide",!1,e._qc,t._qc)},o.prototype._overlapCallback=function(e,t){this.gameObject._sendMessage("onOverlap",!1,e._qc,t._qc)},qc.Serializer.registerCustomDeserializer("qc.ParticleSystem",function(e,t,n){return new qc.ParticleSystem(e,t,n)});var u=qc.ParticleSystem=function(e,t,r){qc.Node.call(this,new Phaser.Group(e.phaser,null),t,r),this.name="Particle System",this.paused=!1,this.onVisibleChanged=new qc.Signal,this.emitter=null;var i=e.assets.find("__builtin_resource__");this.texture=i.getTexture("empty.png"),this.emissionSpace=qc.ParticleSystem.EmissionSpace.WORLD,this.rendererType=qc.ParticleSystem.Renderer.SPRITE,this.zoneType=qc.ParticleSystem.Zones.Zone.POINT,this.edgeEmission=!1,this.zoneLength=100,this.zoneRotation=0,this.zoneRadius=100,this.zoneWidth=100,this.zoneHeight=100,this.frequency=.1,this.quantity=1,this.repeat=-1,this.delay=0,this.lifespan=[5,5],this.angle=[-120,-60],this.blendMode=Phaser.blendModes.NORMAL,this.startColor=new qc.Color(16777215),this.startColorVariation=0,this.endColor=new qc.Color(16777215),this.endColorVariation=0,this.startAlpha=[1,1],this.startScale=[1,1],this.startRotation=[0,0],this.startVelocity=[100,100],this.angularVelocity=[0,0],this.gravity=new qc.Point(0,0),this.maxParticles=200,this.playOnAwake=!0,this.initialFrame=[0,0],this.frameRate=[1,1],this.enableColorCurve=!1,this.colorCurve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),this.enableAlphaCurve=!1,this.alphaCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0)),this.enableScaleCurve=!1,this.scaleCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0)),this.enableVelocityCurve=!1,this.velocityCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0)),this.enableAngularVelocityCurve=!1,this.angularVelocityCurve=new qc.BezierCurve(new qc.Keyframe(0,1,0,0),new qc.Keyframe(1,1,0,0));var s=r!==n;s||this.initEmitter()};u.prototype=t.create(qc.Node.prototype),u.prototype.constructor=u,qc.ParticleSystem.Transitions={},qc.ParticleSystem.Zones={},qc.ParticleSystem.Renderer={},qc.ParticleSystem.Renderer={SPRITE:1},qc.ParticleSystem.EmissionSpace={WORLD:0,LOCAL:1},t.defineProperties(u.prototype,{"class":{get:function(){return"qc.ParticleSystem"}}}),u.prototype.update=function(){if(this.paused)return;var e=this.game.time.deltaTime*.001;this.emitter.update(e)},u.prototype.initEmitter=function(){var e=new qc.ParticleSystem.Emitter(this);this.emitter=e,e.init(),!this.isWorldVisible()||!this.playOnAwake?this.pause():this.start()},u.prototype.start=function(){if(!this.isWorldVisible())return;this.paused=!1,this.emitter.start()},u.prototype.pause=function(){this.paused=!0,this.emitter.pause()},u.prototype.clear=function(){this.emitter.clear()},u.prototype.reset=function(){this.emitter.reset()},u.prototype.onDeserialized=function(){this.initEmitter()},u.prototype.onDestroy=function(){this.emitter.destroy(),this.emitter=null,qc.Node.prototype.onDestroy.call(this)},u.prototype.onVisibleChange=function(){if(this.emitter===null)return;this.onVisibleChanged.dispatch(),this.isWorldVisible()?this.start():(this.clear(),this.pause())},u.prototype.getMeta=function(){var e=this,t=qc.Serializer,n=qc.Node.prototype.getMeta.call(this);return n.rendererType=t.NUMBER,n.texture=t.TEXTURE,n.initialFrame=t.NUMBERS,n.frameRate=t.NUMBERS,n.zoneType=t.NUMBER,n.edgeEmission=t.BOOLEAN,n.zoneLength=t.NUMBER,n.zoneRotation=t.NUMBER,n.zoneRadius=t.NUMBER,n.zoneWidth=t.NUMBER,n.zoneHeight=t.NUMBER,n.emissionSpace=t.NUMBER,n.frequency=t.NUMBER,n.quantity=t.NUMBER,n.repeat=t.NUMBER,n.delay=t.NUMBER,n.lifespan=t.NUMBERS,n.angle=t.NUMBERS,n.blendMode=t.NUMBER,n.startColor=t.COLOR,n.endColor=t.COLOR,n.startAlpha=t.NUMBERS,n.startScale=t.NUMBERS,n.startRotation=t.NUMBERS,n.startVelocity=t.NUMBERS,n.angularVelocity=t.NUMBERS,n.gravity=t.POINT,n.maxParticles=t.NUMBER,n.playOnAwake=t.BOOLEAN,n.enableColorCurve=t.BOOLEAN,n.colorCurve=t.GEOM,n.enableAlphaCurve=t.BOOLEAN,n.alphaCurve=t.GEOM,n.enableScaleCurve=t.BOOLEAN,n.scaleCurve=t.GEOM,n.enableVelocityCurve=t.BOOLEAN,n.velocityCurve=t.GEOM,n.enableAngularVelocityCurve=t.BOOLEAN,n.angularVelocityCurve=t.GEOM,n};var a=qc.ParticleSystem.Transitions.Transform=function(e){this.particle=e,this.particleSystem=e.emitter.owner,this.time=e.emitter.game.time,this.gravity=new Phaser.Point,this.x=0,this.y=0,this.anchor={x:.5,y:.5},this.velocity={x:0,y:0},this.originVelocity={x:0,y:0},this.scale=this.originScale=1,this.rotation=0,this.originAngularVelocity=0};a.prototype.constructor=a,a.prototype.init=function(e,t){this.x=e,this.y=t,this.gravity=this.particleSystem.gravity;var n=qc.ParticleSystem.Util.getRandom(this.particleSystem.angle),r=qc.ParticleSystem.Util.getRandom(this.particleSystem.startVelocity),i=n*Math.PI/180;this.velocity.x=this.originVelocity.x=r*Math.cos(i),this.velocity.y=this.originVelocity.y=r*Math.sin(i),this.scale=this.originScale=qc.ParticleSystem.Util.getRandom(this.particleSystem.startScale),this.rotation=qc.ParticleSystem.Util.getRandom(this.particleSystem.startRotation)*Math.PI/180,this.originAngularVelocity=qc.ParticleSystem.Util.getRandom(this.particleSystem.angularVelocity)*Math.PI/180},a.prototype.update=function(e,t){var n=t;this.originVelocity.x+=this.gravity.x*e,this.originVelocity.y+=this.gravity.y*e;if(this.particleSystem.enableVelocityCurve){var r=this.particleSystem.velocityCurve.evaluate(n);this.velocity.x=this.originVelocity.x*r,this.velocity.y=this.originVelocity.y*r}else this.velocity.x=this.originVelocity.x,this.velocity.y=this.originVelocity.y;this.x+=this.velocity.x*e,this.y+=this.velocity.y*e;if(this.particleSystem.enableScaleCurve){var i=this.particleSystem.scaleCurve.evaluate(n);this.scale=this.originScale*i}if(this.originAngularVelocity!==0){var s=this.originAngularVelocity;this.particleSystem.enableAngularVelocityCurve&&(s*=this.particleSystem.angularVelocityCurve.evaluate(n)),this.rotation+=s*e}};var f=qc.ParticleSystem.Zones.Zone=function(e){this.geometry=null,this._random=new qc.Point,this.edgeEmission=e};f.prototype.constructor=f,f.POINT=1,f.LINE=2,f.RECTANGLE=3,f.CIRCLE=4,f.prototype.getRandom=function(){return this._random},f.prototype.emit=function(e,t){for(var n=0;n<t;n++)this.getRandom(),e.emitParticle(this._random.x,this._random.y,e)};var l=qc.ParticleSystem.Particle=function(e){this.emitter=e,this.particleSystem=e.owner,this.renderer=e.renderer,this.game=this.emitter.owner.game,this.manualDisplayChanged=this.game.phaser.renderType===Phaser.CANVAS&&this.game.dirtyRectangle.enable,this.alive=!0,this.life=0,this.sprite=null,this.transform=new qc.ParticleSystem.Transitions.Transform(this),this.color=new qc.ParticleSystem.Transitions.Color(this)};l.prototype.constructor=l,l.prototype.init=function(e,t){this.life=0,this.alive=!0,this.lifespan=qc.ParticleSystem.Util.getRandom(this.particleSystem.lifespan);var n=qc.ParticleSystem.Util.getRandom(this.particleSystem.frameRate);this.frameInterval=1/n,this.frameTime=0,this.create(e,t),this.particleSystem.emissionSpace===qc.ParticleSystem.EmissionSpace.WORLD&&(this.cacheParentWorldTransform(),this.sprite.updateTransform=l.updateTransform)},l.prototype.create=function(e,t){var n=this.particleSystem.texture;this.transform.init(e,t),this.color.init();if(this.alive){var r;n.atlas.meta.spriteSheet?(this.frameIndex=qc.ParticleSystem.Util.getRandom(this.particleSystem.initialFrame),this.frameIndex=Phaser.Math.clamp(Math.round(this.frameIndex),0,n.atlas.frameNames.length-1),r=n.atlas.frameNames[this.frameIndex]):n.frame===0?r=this.game.phaser.rnd.pick(n.atlas.frameNames):r=n.frame;var i=this.renderer.add(this,n,r);this.renderer.update(this)}this.transform.update(0,0),this.color.update(0,0),this.manualDisplayChanged&&this.sprite.displayChanged(qc.DisplayChangeStatus.SHOW)},l.prototype.update=function(e){this.life+=e,this.life<this.delay?this.sprite.visible=!1:this.sprite.visible=!0,this.renderer.update(this);var t=Phaser.Math.clamp(this.life/this.lifespan,0,1);this.transform.update(e,t),this.color.update(e,t);if(this.life>=this.lifespan){this.terminate();return}this.emitter.owner.texture.atlas.meta.spriteSheet&&(this.frameTime+=e,this.frameTime>=this.frameInterval&&(this.frameIndex++,this.frameIndex>=this.emitter.owner.texture.atlas.frameNames.length&&(this.frameIndex=0),this.sprite.frameName=this.particleSystem.texture.atlas.frameNames[this.frameIndex],this.manualDisplayChanged&&this.sprite.displayChanged(qc.DisplayChangeStatus.SHOW),this.frameTime-=this.frameInterval))},l.prototype.terminate=function(){this.alive=!1,this.sprite.kill(),this.manualDisplayChanged&&this.sprite.displayChanged(qc.DisplayChangeStatus.HIDE)},l.prototype.cacheParentWorldTransform=function(){if(!this.sprite)return;var e=this.emitter.owner.phaser.worldTransform,t=this.sprite._parentWorldTransform=new qc.Matrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},l.updateTransform=function(){if(!this.parent||!this.visible)return;var e=this._parentWorldTransform;if(!e)return;var t=this.worldTransform,n,r,i,s,o,u;if(this.rotation%PIXI.PI_2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),n=this._cr*this.scale.x,r=this._sr*this.scale.x,i=-this._sr*this.scale.y,s=this._cr*this.scale.y,o=this.position.x,u=this.position.y;if(this.pivot.x||this.pivot.y)o-=this.pivot.x*n+this.pivot.y*i,u-=this.pivot.x*r+this.pivot.y*s;t.a=n*e.a+r*e.c,t.b=n*e.b+r*e.d,t.c=i*e.a+s*e.c,t.d=i*e.b+s*e.d,t.tx=o*e.a+u*e.c+e.tx,t.ty=o*e.b+u*e.d+e.ty}else n=this.scale.x,s=this.scale.y,o=this.position.x-this.pivot.x*n,u=this.position.y-this.pivot.y*s,t.a=n*e.a,t.b=n*e.b,t.c=s*e.c,t.d=s*e.d,t.tx=o*e.a+u*e.c+e.tx,t.ty=o*e.b+u*e.d+e.ty;this.worldAlpha=this.alpha,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,t,e)};var c=qc.ParticleSystem.Renderer.Sprite=function(e){this.emitter=e,this.game=this.emitter.game,this.display=e.owner.phaser};c.prototype.constructor=c,c.prototype.add=function(e,t,n){var r=t.atlas.url,i=e.sprite;return i?(i.reset(e.transform.x,e.transform.y),i.key!==r?i.loadTexture(r,n):i.frameName=n):i=this.display.create(e.transform.x,e.transform.y,r,n),i.anchor.set(e.transform.anchor.x,e.transform.anchor.y),i.blendMode=e.color.blendMode,e.sprite=i,i},c.prototype.update=function(e){var t=0,n=e.sprite;if(n.x!==e.transform.x||n.y!==e.transform.y)t|=qc.DisplayChangeStatus.OFFSET,n.x=e.transform.x,n.y=e.transform.y;n.scale.x!==e.transform.scale&&(t|=qc.DisplayChangeStatus.SCALE,n.scale.x=e.transform.scale,n.scale.y=e.transform.scale),n.rotation!==e.transform.rotation&&(t|=qc.DisplayChangeStatus.ROTATION,n.rotation=e.transform.rotation),n.tint!==e.color.tint&&(t|=qc.DisplayChangeStatus.TINT,n.tint=e.color.tint),n.alpha!==e.color.alpha&&(t|=qc.DisplayChangeStatus.ALPHA,n.alpha=e.color.alpha),n._isNotNeedCalcTransform=!1,e.manualDisplayChanged&&n.displayChanged(t)};var h=qc.ParticleSystem.Transitions.Color=function(e){this.particle=e,this.particleSystem=e.emitter.owner,this.time=e.emitter.game.time,this.blendMode=Phaser.blendModes.NORMAL,this.tint=0,this.alpha=this.originAlpha=1};h.prototype.constructor=h,h.prototype.init=function(){var e=qc.ParticleSystem.Util.getRandom,t=qc.ParticleSystem.Util.getRandomByVariation;this.alpha=this.originAlpha=e(this.particleSystem.startAlpha),this.startColor=new qc.Color(16777215),this.startColor.r=t(this.particleSystem.startColor.r,this.particleSystem.startColorVariation),this.startColor.g=t(this.particleSystem.startColor.g,this.particleSystem.startColorVariation),this.startColor.b=t(this.particleSystem.startColor.b,this.particleSystem.startColorVariation),this.endColor=new qc.Color(16777215),this.endColor.r=t(this.particleSystem.endColor.r,this.particleSystem.endColorVariation),this.endColor.g=t(this.particleSystem.endColor.g,this.particleSystem.endColorVariation),this.endColor.b=t(this.particleSystem.endColor.b,this.particleSystem.endColorVariation),this.tint=this.startColor.toNumber(),this.blendMode=this.particleSystem.blendMode},h.prototype.update=function(e,t){var n=t,r=this.startColor.rgb,i=this.endColor.rgb;if(r[0]!==i[0]||r[1]!==i[1]||r[2]!==i[2]){var s;this.particleSystem.enableColorCurve?s=this.particleSystem.colorCurve.evaluate(n):s=n;var o=255,u=255,a=255;r[0]!==i[0]&&(o=Phaser.Math.clamp(Math.round(r[0]+s*(i[0]-r[0])),0,255)),r[1]!==i[1]&&(u=Phaser.Math.clamp(Math.round(r[1]+s*(i[1]-r[1])),0,255)),r[2]!==i[2]&&(a=Phaser.Math.clamp(Math.round(r[2]+s*(i[2]-r[2])),0,255)),this.tint=o<<16|u<<8|a}if(this.particleSystem.enableAlphaCurve){var f=this.particleSystem.alphaCurve.evaluate(n);this.alpha=this.originAlpha*f}};var p=qc.defineBehaviour("qc.EmitterViewer",qc.Behaviour,function(){var e=this;e.now=e.game.time.now,e.runInEditor=!0,e.debugOn=!0,e.duration=1},{debugOn:qc.Serializer.BOOLEAN,particleSystem:qc.Serializer.NODE});p.__menu="Debug/EmitterViewer",t.defineProperties(p.prototype,{debugOn:{get:function(){return this._debugOn},set:function(e){this._debugOn=e}},particleSystem:{get:function(){return this._particleSystem},set:function(e){this._particleSystem=e}}}),p.prototype.postUpdate=function(){if(!this.particleSystem)return;if(!this.debugOn)return;var e=this.game.time.now;if(e-this.now>=this.duration*1e3){var t=this.particleSystem.emitter;if(t===null)return;var n=qc.Util.formatString("\n\n({0})\nAlive:{1}\nDead:{2}\nTotal:{3}",this.particleSystem.name,t.list.length,t.pool.length,t.list.length+t.pool.length);this.gameObject instanceof qc.UIText?this.gameObject.text=n:this.gameObject instanceof qc.Dom&&(n=n.replace(/\n/g,"<br/>"),this.gameObject.innerHTML=n)}},qc.ParticleSystem.Util={getRandom:function(e){if(!Array.isArray(e)||e.length<2)return 0;var t=e[0]||0,n=e[1]||0,r=Math.random(),i=t+r*(n-t);return i},getRandomByVariation:function(e,t){return e=e||0,t=t||0,e+t*(1-2*Math.random())}};var d=qc.ParticleSystem.Zones.Circle=function(e,t){qc.ParticleSystem.Zones.Zone.call(this,t),this.geometry=new qc.Circle(0,0,e*2)};d.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),d.prototype.constructor=d,d.prototype.getRandom=function(){var e=2*Math.PI*Math.random(),t=this.geometry.radius*(this.edgeEmission?1:Math.random());this._random.x=this.geometry.x+t*Math.cos(e),this._random.y=this.geometry.y+t*Math.sin(e)};var v=qc.ParticleSystem.Zones.Line=function(e,t){qc.ParticleSystem.Zones.Zone.call(this);var n=t*Math.PI/180,r=e/2*Math.cos(n),i=e/2*Math.sin(n),s=-r,o=-i;this.geometry=new qc.Line(r,i,s,o)};v.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),v.prototype.constructor=v,v.prototype.getRandom=function(){var e=Math.random();this._random.x=this.geometry.start.x+e*(this.geometry.end.x-this.geometry.start.x),this._random.y=this.geometry.start.y+e*(this.geometry.end.y-this.geometry.start.y)};var m=qc.ParticleSystem.Zones.Point=function(){qc.ParticleSystem.Zones.Zone.call(this),this.geometry=new qc.Point};m.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),m.prototype.constructor=m,m.prototype.getRandom=function(){this._random=this.geometry};var g=qc.ParticleSystem.Zones.Rectangle=function(e,t,n){qc.ParticleSystem.Zones.Zone.call(this,n);var r=-e/2,i=-t/2;this.geometry=new qc.Rectangle(r,i,e,t)};g.prototype=t.create(qc.ParticleSystem.Zones.Zone.prototype),g.prototype.constructor=g,g.prototype.getRandom=function(){if(!this.edgeEmission)this._random.x=this.geometry.x+Math.random()*this.geometry.width,this._random.y=this.geometry.y+Math.random()*this.geometry.height;else{var e,t,n=Math.random()*this.geometry.perimeter;n<=this.geometry.width?(e=n,t=0):n<=this.geometry.width+this.geometry.height?(e=this.geometry.width,t=n-this.geometry.width):n<=this.geometry.width*2+this.geometry.height?(e=this.geometry.width*2+this.geometry.height-n,t=this.geometry.height):(e=0,t=this.geometry.perimeter-n),this._random.x=this.geometry.x+e,this._random.y=this.geometry.y+t}};var y=qc.ParticleSystem.Emitter=function(e){this.game=e.game.phaser,this.owner=e,this.particleClass=qc.ParticleSystem.Particle,this.list=[],this.pool=[],this.paused=!1};y.prototype.constructor=y,y.prototype.init=function(){this.renderer=this.createRenderer(this.owner.rendererType),this.zone=this.createZone(),this.timer=this.game.time.create(!1)},y.prototype.start=function(){this.paused=!1;if(!this.timer.running){var e=this.owner.repeat,t=this.owner.frequency*1e3;e===-1?this.timer.loop(t,this.emitImp,this):e>0&&this.timer.repeat(t,e,this.emitImp,this),this.timer.start(this.owner.delay*1e3)}else this.timer.resume()},y.prototype.pause=function(){this.paused=!0,this.timer.pause()},y.prototype.update=function(e){for(var t=this.list.length-1;t>=0;t--){var n=this.list[t];n.update(e),n.alive||(this.pool.push(n),this.list.splice(t,1))}},y.prototype.clear=function(){for(var e=0;e<this.list.length;e++){var t=this.list[e];t.terminate()}this.list=[],this.pool=[]},y.prototype.reset=function(){this.clear(),this.renderer=null,this.zone=null,this.timer.destroy(),this.init()},y.prototype.destroy=function(){this.clear(),this.renderer=null,this.zone=null,this.timer.destroy(),this.timer=null},y.prototype.emitParticle=function(e,t,n){if(this.list.length>=this.owner.maxParticles)return;var r=this.pool.pop();r||(r=new this.particleClass(this)),r.init(e,t),r.alive?this.list.push(r):this.pool.push(r)},y.prototype.emitImp=function(){var e=this.owner.quantity;this.zone&&this.zone.emit(this,e)},y.prototype.createRenderer=function(e){e=e||qc.ParticleSystem.RENDER_TYPE_SPRITE;var t;switch(e){case qc.ParticleSystem.Renderer.SPRITE:t=new qc.ParticleSystem.Renderer.Sprite(this);break;default:console.error("Invalid renderer type "+e)}return t},y.prototype.createZone=function(){var e=this.owner.zoneType,t=this.owner.edgeEmission,n;switch(e){case qc.ParticleSystem.Zones.Zone.POINT:n=new qc.ParticleSystem.Zones.Point;break;case qc.ParticleSystem.Zones.Zone.LINE:var r=this.owner.zoneLength,i=this.owner.zoneRotation;n=new qc.ParticleSystem.Zones.Line(r,i);break;case qc.ParticleSystem.Zones.Zone.CIRCLE:var s=this.owner.zoneRadius;n=new qc.ParticleSystem.Zones.Circle(s,t);break;case qc.ParticleSystem.Zones.Zone.RECTANGLE:var o=this.owner.zoneWidth,u=this.owner.zoneHeight;n=new qc.ParticleSystem.Zones.Rectangle(o,u,t);break;default:console.error("Invalid zone type "+zoneType)}return n};var b=qc.defineBehaviour("qc.engine.Buf_Resonator",qc.Behaviour,function(){this._timeout_max=3e3,this._timeout=0,this._blink_speed=0,this._blink_speed_step=1/this._timeout_max*5,this.activated=!1,this.skill=this.gameObject.ShipCtr.skills.resonator,this.gnum=this.game.world._findByName("root")._findByName("gnum"),this.asters=this.game.world._findByName("root")._findByName("asteroidRoot"),this.ufos=this.game.world._findByName("root")._findByName("ufoRoot"),this.bullets=this.game.world._findByName("root")._findByName("bulletRoot"),this.icon=this.game.world._findByName("root")._findByName("icon_resonator"),this.fx_1=this.game.world._findByName("root")._findByName("fx_airblast_1"),this.fx_2=this.game.world._findByName("root")._findByName("fx_airblast_2"),this.fx_3=this.game.world._findByName("root")._findByName("fx_airblast_3"),this.fx_4=this.game.world._findByName("root")._findByName("fx_airblast_4")},{});b.prototype.activate=function(){var e=this;e.activated=!0,e.runned=0,e.inwork=0,e.icon.alpha=1,e.icon.visible=!0,e._timeout=e.game.time.now+e._timeout_max,e.gameObject.addScript("qc.engine.Buf_Untochable")},b.prototype.apply=function(){var e=this,t,n;if(e.activated&&e.runned<e.skill.level){n=e.game.add.sound(),n.audio=e.gameObject.ShipCtr.sounds[3],n.loop=!1,n.volume=.6,n.play(),e.runned++,e.inwork++,t="fx_"+e.runned,e[t].visible=!0;var r=e[t].Animator.getAction(0);r.onFinished.removeAll(),r.onFinished.add(function(t){t.targetObject.visible=!1,e.inwork--}),e[t].Animator.play(),e[t].x=e.gameObject.x,e[t].y=e.gameObject.y,e[t].hitted=[]}},b.prototype.remove=function(){this.icon.visible=!1,this.skill.reset(),this.gameObject.removeScript(this)},b.prototype.update=function(){var e=this,t,n,r,i;if(!e.activated)return;if(e.game.time.now<e._timeout){var s=Math.abs(e._blink_speed)+e._blink_speed_step;e._blink_speed=e._blink_speed<0?-s:s,e.icon.alpha+=e._blink_speed,e.icon.alpha<0?(e.icon.alpha=0,e._blink_speed=-e._blink_speed):e.icon.alpha>1&&(e.icon.alpha=1,e._blink_speed=-e._blink_speed)}else e.inwork<1&&(e.icon.visible=!1,e.activated=!1);for(var o=1,u=e.runned+1;o<u;++o){r=e["fx_"+o];if(r.visible){e.gnum.Gnum.isActive&&(n=e.game.math.distance(e.gnum.x,e.gnum.y,r.x,r.y),n<e.gnum.width/2+r.width/2&&e.gnum.Gnum.teleport());for(var a=0,f=e.ufos.children.length;a<f;++a){t=e.ufos.children[a];if(t.visible){n=e.game.math.distance(t.x,t.y,r.x,r.y);if(n<t.width/2+r.width/2){e.ufos.UfoPool.remove(t),e.bullets.BulletPool.addHit(3);var l=e.game.add.clone(e.bullets.BulletPool.boomPrefab);l.x=t.x,l.y=t.y}}}for(var a=0,f=e.asters.children.length;a<f;++a){t=e.asters.children[a],i=!1;for(var c=0,h=r.hitted.length;c<h;++c)if(t==r.hitted[c]){i=!0;break}if(!i&&t.Asteroid.type==="ast"&&t.visible){n=e.game.math.distance(t.x,t.y,r.x,r.y);if(n<r.width/2+t.Asteroid.radius){var p=r.width/2/t.Asteroid.radius,d=(r.x+p*t.x)/(1+p),v=(r.y+p*t.y)/(1+p);e.bullets.BulletPool.addHit(t.Asteroid.size);var l=e.game.add.clone(e.bullets.BulletPool.boomPrefab);l.x=d,l.y=v,t.Asteroid.hp-=1,t.Asteroid.hp<1&&(e.asters.AsteroidPool.remove(t),e.bullets.BulletPool.addBoom(t.Asteroid.size)),t.Asteroid.size>1&&r.hitted.push(t)}}}}}};var w=qc.defineBehaviour("qc.engine.Asteroid",qc.Behaviour,function(){this.moveSpeed=5,this.angleSpeed=1,this._dir={x:1,y:1},this.score=0,this.hp=0},{type:qc.Serializer.STRING,score:qc.Serializer.NUMBER,maxHP:qc.Serializer.NUMBER,size:qc.Serializer.NUMBER,moveSpeed:qc.Serializer.NUMBER,angleSpeed:qc.Serializer.NUMBER});w.prototype.awake=function(){var e=this;e.radius=e.gameObject.width/2,e.hideTop=-e.gameObject.height/2-50,e.hideRight=e.game.width+e.gameObject.width/2+50,e.hideBottom=e.game.height+e.gameObject.height/2+50,e.hideLeft=-e.gameObject.width/2-50,e.hp=e.maxHP;var t=Math.floor(Math.random()*2)+1;e.gameObject.frame="asteroid"+e.size+t+".png"},w.prototype.init=function(e){var t=this,n=this.gameObject,r,i,s;t.hp=t.maxHP,n.visible=!0,n.x=e.x,n.y=e.y;if(n.x<0||n.x>t.game.width||n.y<0||n.y>t.game.height)r=t.game.width/2+Math.random()*250,i=t.game.height/2+Math.random()*250,s=t.game.math.distance(n.x,n.y,r,i),t._dir.x=(r-n.x)/s,t._dir.y=(i-n.y)/s;else{var o=Math.random()*360;t._dir.x=Math.cos(o),t._dir.y=Math.sin(o)}};var E=qc.defineBehaviour("qc.engine.Bns_1000",qc.Behaviour,function(){},{});E.prototype.awake=function(){this.game.world._findByName("observer").HUD.addScore(1e3),this.gameObject.removeScript(this)};var S=qc.defineBehaviour("qc.engine.Bns_Firerate",qc.Behaviour,function(){this._timeout_max=3e3,this._timeout=0},{});S.prototype.awake=function(){var e=this;e._timeout=e.game.time.now+e._timeout_max,e.gameObject.ShipCtr.bonus.firerate=150},S.prototype.update=function(){var e=this;e.game.time.now>e._timeout&&(e.gameObject.removeScript(e),e.gameObject.ShipCtr.bonus.firerate=0)};var x=qc.defineBehaviour("qc.engine.Bns_Ship",qc.Behaviour,function(){},{});x.prototype.awake=function(){this.game.world._findByName("observer").HUD.addLives(1),this.gameObject.removeScript(this)};var T=qc.defineBehaviour("qc.engine.Bonus",qc.Behaviour,function(){this._timeout_max=25e3,this._timeout=0,this._blink_speed=0,this._blink_speed_step=1/this._timeout_max*8,this._ang=0},{});T.prototype.init=function(){var e=this;e.gameObject.visible=!0,e._timeout=e.game.time.now+e._timeout_max,e._ang=Math.random()*360},T.prototype.update=function(){var e=this,t=e.gameObject,n=e.game.time.now;if(n<e._timeout){if(e._timeout-n<5e3){var r=Math.abs(e._blink_speed)+e._blink_speed_step;e._blink_speed=e._blink_speed<0?-r:r,t.alpha+=e._blink_speed,t.alpha<0?(t.alpha=0,e._blink_speed=-e._blink_speed):t.alpha>1&&(t.alpha=1,e._blink_speed=-e._blink_speed)}}else t.visible=!1;var i=e.game.time.deltaTime/1e3;e._ang+=i,t.Asteroid._dir.x=Math.cos(e._ang),t.Asteroid._dir.y=Math.sin(e._ang)};var N=qc.defineBehaviour("qc.engine.Boom",qc.Behaviour,function(){},{});N.prototype.awake=function(){var e=this;e.gameObject.playAnimation("boom"),e.gameObject.onFinished.addOnce(function(){e.gameObject.destroy()})};var C=qc.defineBehaviour("qc.engine.Btn_Credits",qc.Behaviour,function(){},{});C.prototype.onClick=function(){var e=this;e.game.scene.load("credits")};var k=qc.defineBehaviour("qc.engine.Btn_Lang_EN",qc.Behaviour,function(){},{locales:qc.Serializer.NODE,root:qc.Serializer.NODE});k.prototype.onClick=function(){var e=this;qc.lang="en",e.root._dispatchLocale(),e.game.storage.set("lang",qc.lang),e.game.storage.save()};var L=qc.defineBehaviour("qc.engine.Btn_Lang_RU",qc.Behaviour,function(){},{locales:qc.Serializer.NODE,root:qc.Serializer.NODE});L.prototype.onClick=function(){var e=this;qc.lang="ru",e.root._dispatchLocale(),e.game.storage.set("lang",qc.lang),e.game.storage.save()};var A=qc.defineBehaviour("qc.engine.Btn_OptionsClose",qc.Behaviour,function(){},{win:qc.Serializer.NODE,mutesound:qc.Serializer.NODE,drag:qc.Serializer.NODE,seamless:qc.Serializer.NODE,ctrl_grp:qc.Serializer.NODE});A.prototype.onUp=function(){this.win.visible=!1;var e=this.ctrl_grp.ToggleGroup.toggle.name=="tgl_mouse"?"mouse":"wasd";this.game.storage.set("mutesound",this.mutesound.on),this.game.storage.set("drag",this.drag.value),this.game.storage.set("seamless",this.seamless.on),this.game.storage.set("control_type",e),this.game.storage.save()};var O=qc.defineBehaviour("qc.engine.Btn_ShopBuy",qc.Behaviour,function(){},{observer:qc.Serializer.NODE,shop:qc.Serializer.NODE,ship:qc.Serializer.NODE,tech:qc.Serializer.NODE,score:qc.Serializer.NODE,sounds:qc.Serializer.AUDIOS});O.prototype.awake=function(){var e=this;e.sndFail=e.game.add.sound(),e.sndFail.destroyWhenStop=!1,e.sndFail.audio=e.sounds[0],e.sndFail.loop=!1,e.sndOK=e.game.add.sound(),e.sndOK.destroyWhenStop=!1,e.sndOK.audio=e.sounds[1],e.sndOK.loop=!1},O.prototype.onUp=function(){var e=this,t=!1,n,r=e.ship.ShipCtr.skills;if(e.shop.current_item=="")return;switch(e.shop.current_item){case"itm_ship":n=r.life,t=n.up(e.observer.HUD._money),t&&(e.observer.HUD.addLives(1),e.observer.HUD.addMoney(-n.cost),e.tech.text=qc.lc_format("shop_item_ship_tech",{ships:n.value,cost:n.cost}));break;case"itm_teleport":n=r.teleport,t=n.up(e.observer.HUD._money),t&&(e.tech.text=qc.lc_format("shop_item_teleport_tech",{level:n.level,sec:n.lget(),nsec:n.nget(),cost:n.cost}),e.observer.HUD.addMoney(-n.cost),n.level===1&&e.ship.addScript("qc.engine.Buf_Teleport"));break;case"itm_firerate":n=r.firerate,t=n.up(e.observer.HUD._money),t&&(e.tech.text=qc.lc_format("shop_item_firerate_tech",{level:n.level,rate:n.lget(),nrate:n.nget(),cost:n.cost}),e.observer.HUD.addMoney(-n.cost),n.level===1?e.ship.addScript("qc.engine.Buf_Firerate"):e.ship.Buf_Firerate.advance(-100));break;case"itm_cloaker":n=r.cloaker,t=n.up(e.observer.HUD._money),t&&(e.tech.text=qc.lc_format("shop_item_cloaker_tech",{level:n.level,chance:n.lget(),nchance:n.nget(),cost:n.cost}),e.observer.HUD.addMoney(-n.cost));break;case"itm_resonator":n=r.resonator,t=n.up(e.observer.HUD._money),t&&(e.tech.text=qc.lc_format("shop_item_resonator_tech",{level:n.level,wavecount:n.lget(),nwavecount:n.nget(),cost:n.cost}),e.observer.HUD.addMoney(-n.cost),n.level===1&&e.ship.addScript("qc.engine.Buf_Resonator"));break;case"itm_radar":n=r.radar,t=n.up(e.observer.HUD._money),t&&(e.tech.text=qc.lc_format("shop_item_radar_tech",{level:n.level,targets:n.lget(),ntargets:n.nget(),cost:n.cost}),e.observer.HUD.addMoney(-n.cost),n.level===1&&e.ship.addScript("qc.engine.Buf_Radar"))}t?(n.cost>e.observer.HUD._money&&(e.score.color=new qc.Color("#FF0000")),e.game.storage.get("mutesound")||e.sndOK.play()):e.game.storage.get("mutesound")||e.sndFail.play()};var M=qc.defineBehaviour("qc.engine.Btn_ShopClose",qc.Behaviour,function(){},{observer:qc.Serializer.NODE,shop:qc.Serializer.NODE});M.prototype.onUp=function(){this.shop.visible=!1,this.observer.HUD.isPause=!1};var _=qc.defineBehaviour("qc.engine.Btn_ShopItem",qc.Behaviour,function(){},{observer:qc.Serializer.NODE,ship:qc.Serializer.NODE,shop:qc.Serializer.NODE,score:qc.Serializer.NODE,desc:qc.Serializer.NODE,tech:qc.Serializer.NODE});_.prototype.awake=function(){this.gameObject.onUp.removeAll(),this.gameObject.onDown.removeAll()},_.prototype.resetButtons=function(){var e=this;for(var t=0,n=e.shop.children.length;t<n;t++)e.shop.children[t].name.indexOf("itm_")===0&&(e.shop.children[t].state=qc.UIState.NORMAL);e.desc.text=">",e.tech.text=">",e.shop.current_item="",e.score.color=new qc.Color("#B8BCE0")},_.prototype.onUp=function(){var e=this,t,n,r,i=e.ship.ShipCtr.skills;for(var s=0,o=e.shop.children.length;s<o;s++)e.shop.children[s].name.indexOf("itm_")===0&&(e.shop.children[s].state=qc.UIState.NORMAL);if(e.gameObject.state===qc.UIState.PRESSED){e.gameObject.state=qc.UIState.NORMAL,e.desc.text=">",e.tech.text=">",e.shop.current_item="";return}e.gameObject.state=qc.UIState.PRESSED,e.shop.current_item=e.name;switch(e.name){case"itm_ship":n=i.life,r=n.cost,e.desc.text=qc.lc_get("shop_item_ship_desc"),e.tech.text=qc.lc_format("shop_item_ship_tech",{ships:e.observer.HUD._lives,cost:r});break;case"itm_teleport":e.desc.text=qc.lc_get("shop_item_teleport_desc"),n=i.teleport,r=n.cost,e.tech.text=qc.lc_format("shop_item_teleport_tech",{level:n.level,sec:n.lget(),nsec:n.nget(),cost:r});break;case"itm_firerate":n=i.firerate,e.desc.text=qc.lc_format("shop_item_firerate_desc",{time:n.base_timeout/1e3,step:20}),r=n.cost,e.tech.text=qc.lc_format("shop_item_firerate_tech",{level:n.level,rate:n.lget(),nrate:n.nget(),cost:r});break;case"itm_cloaker":e.desc.text=qc.lc_get("shop_item_cloaker_desc"),n=i.cloaker,r=n.cost,e.tech.text=qc.lc_format("shop_item_cloaker_tech",{level:n.level,chance:n.lget(),nchance:n.nget(),cost:r});break;case"itm_resonator":e.desc.text=qc.lc_get("shop_item_resonator_desc"),n=i.resonator,r=n.cost,e.tech.text=qc.lc_format("shop_item_resonator_tech",{level:n.level,wavecount:n.lget(),nwavecount:n.nget(),cost:r});break;case"itm_radar":e.desc.text=qc.lc_get("shop_item_radar_desc"),n=i.radar,r=n.cost,e.tech.text=qc.lc_format("shop_item_radar_tech",{level:n.level,targets:n.lget(),ntargets:n.nget(),cost:r})}};var D=qc.defineBehaviour("qc.engine.Btn_StartGame",qc.Behaviour,function(){},{});D.prototype.onClick=function(){var e=this;e.game.scene.load("game")};var P=qc.defineBehaviour("qc.engine.Btn_options",qc.Behaviour,function(){},{win:qc.Serializer.NODE,mutesound:qc.Serializer.NODE,seamless:qc.Serializer.NODE,drag:qc.Serializer.NODE,ctrl_grp:qc.Serializer.NODE,ctrl_mouse:qc.Serializer.NODE,ctrl_wasd:qc.Serializer.NODE});P.prototype.onUp=function(){this.win.visible=!0,this.mutesound.on=this.game.storage.get("mutesound")||!1,this.seamless.on=this.game.storage.get("seamless")||!1,this.drag.value=this.game.storage.get("drag")||0;var e=this.game.storage.get("control_type")||"mouse",t=this.ctrl_grp.ToggleGroup;e=="mouse"?t.toggle=this.ctrl_mouse:t.toggle=this.ctrl_wasd};var H=qc.defineBehaviour("qc.engine.Buf_Firerate",qc.Behaviour,function(){this._timeout=0,this.icon=this.game.world._findByName("root")._findByName("icon_firerate"),this.counter=this.icon._findByName("counter")},{});H.prototype.awake=function(){this.skill=this.gameObject.ShipCtr.skills.firerate,this.icon.visible=!0,this.icon.alpha=.5,this.counter.text="0"},H.prototype.advance=function(e){var t=this.skill.points+=e;t>this.skill.level?t=this.skill.level:t<0?(t=0,this.icon.alpha=.5):(this.icon.alpha=1,this.skill.timeout=this.skill.base_timeout),this.counter.text=t+"/"+this.skill.level,this.skill.points=t},H.prototype.remove=function(){this.icon.visible=!1,this.gameObject.ShipCtr.skills.firerate.reset(),this.gameObject.removeScript(this)},H.prototype.update=function(){this.skill.points>0&&(this.skill.timeout-=this.game.time.deltaTime,this.skill.timeout<0&&this.advance(-1))};var B=qc.defineBehaviour("qc.engine.Buf_Radar",qc.Behaviour,function(){this.skill=this.gameObject.ShipCtr.skills.radar,this.ufos=this.game.world._findByName("root")._findByName("ufoRoot"),this.ship=this.game.world._findByName("root")._findByName("ship"),this.gnum=this.game.world._findByName("root")._findByName("gnum"),this.icon=this.game.world._findByName("root")._findByName("radar"),this.scan=this.icon._findByName("scan"),this.r_ship=this.icon._findByName("ship"),this.r_gnum=this.icon._findByName("gnum"),this.r_ufos=[this.icon._findByName("ufo1"),this.icon._findByName("ufo2"),this.icon._findByName("ufo3")]},{});B.prototype.awake=function(){this.icon.visible=!0,this.icon.alpha=0,this.scan.Animator.play(),this.icon.TweenAlpha.play(),this.snd=this.game.add.sound(),this.snd.destroyWhenStop=!1,this.snd.audio=this.ship.ShipCtr.sounds[4],this.snd.loop=!1,this.snd.volume=.6;for(var e=0,t=this.r_ufos.length;e<t;++e)this.r_ufos[e].visible=!1},B.prototype.remove=function(){this.icon.visible=!1;for(var e=0,t=this.r_ufos.length;e<t;++e)this.r_ufos[e].visible=!1;this.skill.reset(),this.game.world.removeChild(this.snd),this.gameObject.removeScript(this)},B.prototype.update=function(){var e,t,n;this.r_ship.x=this.ship.x/8.9,this.r_ship.y=this.ship.y/13.5,n=0,this.gnum.Gnum.isActive?(this.r_gnum.visible=!0,this.r_gnum.x=this.gnum.x/8.9,this.r_gnum.y=this.gnum.y/13.5,n++):this.r_gnum.visible=!1;for(var r=0,i=this.ufos.children.length;r<i;++r)e=this.ufos.children[r],e.visible&&n++,t=this.r_ufos[r],t.visible=e.visible,t.x=e.x/8.9,t.y=e.y/13.5;n>0&&!this.snd.isPlaying&&this.snd.play()};var j=qc.defineBehaviour("qc.engine.AsteroidPool",qc.Behaviour,function(){this._wave=0,this._waveReady=!0,this._alive=0},{sounds:qc.Serializer.AUDIOS,asteroid1Prefab:qc.Serializer.PREFAB,asteroid2Prefab:qc.Serializer.PREFAB,asteroid3Prefab:qc.Serializer.PREFAB,asteroid4Prefab:qc.Serializer.PREFAB,gemsPrefab:qc.Serializer.PREFAB,bonusPrefab:qc.Serializer.PREFAB,ship:qc.Serializer.NODE,gnum:qc.Serializer.NODE,observer:qc.Serializer.NODE});j.prototype.awake=function(){var e=this;e.isAwake=!0,!e.observer.HUD&&e.observer.Observer_menu&&(e.observer.HUD=e.observer.Observer_menu)},j.prototype.addBoom=function(){var e=this;if(!e.game.storage.get("mutesound")){var t=e.game.add.sound();t.destroyWhenStop=!0,t.audio=e.sounds[0],t.loop=!1,t.volume=1,t.play()}},j.prototype.addPick=function(e){var t=this,n=2;if(!t.game.storage.get("mutesound")){var r=t.game.add.sound();r.destroyWhenStop=!0,e=="gem"?n="2":e=="bonus"&&(n="1"),r.audio=t.sounds[n],r.loop=!1,r.volume=1,r.play()}},j.prototype.addBy=function(e,t){var n=this;t=e.Asteroid?e.Asteroid.size-1:4;if(t>0&&t<5){var r=0,i,s,o;switch(t){case 4:i=1,s=n.asteroid4Prefab;break;case 3:i=3,s=n.asteroid3Prefab;break;case 2:i=3,s=n.asteroid2Prefab;break;case 1:i=4,s=n.asteroid1Prefab}var u=[];if(i>1){var a=e.Asteroid.radius/2;ang=360/i;for(o=0;o<i;o++)u.push({x:e.x+a*Math.cos(ang*o),y:e.y+a*Math.sin(ang*o)})}else u.push({x:e.x,y:e.y});var f;for(o in n.gameObject.children){f=n.gameObject.children[o];if(f.visible===!1&&f.type==="ast"&&f.Asteroid.size==t){f.Asteroid.init(u[r]),r++;if(r===i)return}}for(o=r;o<i;o++)f=n.game.add.clone(s,n.gameObject),f.Asteroid.init(u[o])}},j.prototype.remove=function(e){var t=this,n,r;e.visible=!1;if(e.Asteroid.type==="ast"){t.addBy(e);if(Math.random()<.2){var i=!0;for(n in t.gameObject.children){r=t.gameObject.children[n];if(r.visible===!1&&r.type==="gem"){i=!1;break}}i&&(r=t.game.add.clone(t.gemsPrefab,t.gameObject));var s=Math.floor(Math.random()*3),o=["gem_blue.png","gem_red.png","gem_green.png"];r.frame=o[s],r.Asteroid.init({x:e.x,y:e.y})}var u=Math.random();if(u<.1){var a=!0;for(n in t.gameObject.children){r=t.gameObject.children[n];if(r.visible===!1&&r.type==="bns"){a=!1;break}}a&&(r=t.game.add.clone(t.bonusPrefab,t.gameObject));var o=["shop_itm_ship.png","shop_itm_firerate.png","1000.png"],f=["qc.engine.Bns_Ship","qc.engine.Bns_Firerate","qc.engine.Bns_1000"],s=1+Math.floor(Math.random()*2);u<=.01&&(s=0),r.frame=o[s],r.Asteroid.init({x:e.x,y:e.y}),r.Bonus.init(),r.Asteroid.bonus=f[s]}}},j.prototype.removeAll=function(){var e=this;e._gems=0;for(var t in e.gameObject.children)e.gameObject.children[t].visible=!1},j.prototype.nextWave=function(){var e=this;e._waitForWave=!0,this.game.timer.add(3e3,function(){var t=Math.floor(e.game.width/100),n=Math.floor(e.game.height/100),r=Math.floor(e.ship.x/100),i=Math.floor(e.ship.y/100),s=[];for(var o=0;o<n;o++)for(var u=0;u<t;u++)u!=r&&o!=i&&s.push({x:u*100+50,y:o*100+50});for(var a=0;a<e._wave;a++){var f=s[Math.floor(Math.random()*s.length)];e.addBy(f)}e._waitForWave=!1})},j.prototype.getNear=function(e,t){var n=this,r=999999,i,s,o=!1;for(var u in n.gameObject.children)i=n.gameObject.children[u],i.visible===!0&&i.Asteroid.type==="ast"&&i.Asteroid.size===t&&(s=n.game.math.distance(e.x,e.y,i.x,i.y),s<r&&(r=s,o=i));return o},j.prototype.getNearGem=function(e){var t=this,n=999999,r,i,s=!1;for(var o=0,u=t.gameObject.children.length;o<u;++o)r=t.gameObject.children[o],r.visible===!0&&r.Asteroid.type==="gem"&&(i=t.game.math.distance(e.x,e.y,r.x,r.y),i<n&&(n=i,s=r));return s},j.prototype.update=function(){var e=this;if(e.isAwake!==!0||e.observer.HUD.isPause)return;e._alive=0,e._gems=0;for(var t=0,n=e.gameObject.children.length;t<n;++t)if(e.gameObject.children[t].visible===!0){var r=e.gameObject.children[t];r.Asteroid.type==="ast"?e._alive++:e._gems++;var i=e.game.time.deltaTime/1e3;r.x+=r.Asteroid._dir.x*r.Asteroid.moveSpeed*i,r.y+=r.Asteroid._dir.y*r.Asteroid.moveSpeed*i,r.rotation+=r.Asteroid.angleSpeed*i;if(e.ship.visible===!0){var s=e.game.math.distance(r.x,r.y,e.ship.x,e.ship.y);s<e.ship.ShipCtr.radius+r.Asteroid.radius&&(r.Asteroid.type==="ast"&&e.ship._untouchable===!1?(e.observer.HUD.addLives(-1),e.addBoom()):r.Asteroid.type==="gem"?(e.observer.HUD.addMoney(r.Asteroid.score),e.remove(r),e.addPick("gem")):r.Asteroid.type==="bns"&&(e.ship.addScript(r.Asteroid.bonus),e.remove(r),e.addPick("bonus")))}if(e.gnum.Gnum.isActive===!0&&r.Asteroid.type==="gem"){var s=e.game.math.distance(r.x,r.y,e.gnum.x,e.gnum.y);s<e.gnum.Gnum.radius+r.Asteroid.radius&&(e.remove(r),e.addPick("gem"))}if(r.x<r.Asteroid.hideLeft||r.x>r.Asteroid.hideRight||r.y<r.Asteroid.hideTop||r.y>r.Asteroid.hideBottom)r.x=e.game.width-r.x+(r.x<0?-10:10),r.y=e.game.height-r.y+(r.y<0?-10:10)}e._alive==0&&!e._waitForWave&&(e._wave++,e.observer.HUD.setWave(e._wave),e.nextWave())};var F=qc.defineBehaviour("qc.engine.Buf_Teleport",qc.Behaviour,function(){this._timeout=0,this.icon=this.game.world._findByName("root")._findByName("icon_teleport"),this.counter=this.icon._findByName("counter"),this.fx=this.game.world._findByName("root")._findByName("fx_teleport")},{});F.prototype.awake=function(){this.skill=this.gameObject.ShipCtr.skills.teleport,this.icon.visible=!0,this.counter.visible=!1},F.prototype.apply=function(){var e=this,t=e.game.time.now;return t>e._timeout?(e.fx.Animator.play(),e.fx.x=e.gameObject.x,e.fx.y=e.gameObject.y,e._timeout=t+e.skill.value*1e3,e.counter.text=""+e.skill.value,e.counter.visible=!0,e.icon.colorTint=new qc.Color("#5E5E5E"),e.gameObject.x=e.game.input.cursorPosition.x,e.gameObject.y=e.game.input.cursorPosition.y,!0):!1},F.prototype.update=function(){var e=this,t=e.game.time.now;t<e._timeout?e.counter.text=""+Math.floor((e._timeout-t)/1e3):e.counter.visible&&(e.counter.visible=!1,e.icon.colorTint=new qc.Color("#FFFFFF"))};var I=qc.defineBehaviour("qc.engine.Buf_Untochable",qc.Behaviour,function(){this._timeout_max=3e3,this._timeout=0,this._blink_speed=0,this._blink_speed_step=1/this._timeout_max*5},{});I.prototype.awake=function(){var e=this;e._timeout=e.game.time.now+e._timeout_max,e.gameObject._untouchable=!0},I.prototype.update=function(){var e=this;if(e.game.time.now<e._timeout){var t=Math.abs(e._blink_speed)+e._blink_speed_step;e._blink_speed=e._blink_speed<0?-t:t,e.gameObject.alpha+=e._blink_speed,e.gameObject.alpha<0?(e.gameObject.alpha=0,e._blink_speed=-e._blink_speed):e.gameObject.alpha>1&&(e.gameObject.alpha=1,e._blink_speed=-e._blink_speed)}else e.gameObject.alpha=1,e.gameObject.removeScript(e),e.gameObject._untouchable=!1};var q=qc.defineBehaviour("qc.engine.Bullet",qc.Behaviour,function(){this._liveTime=2e3},{speed:qc.Serializer.NUMBER});q.prototype.init=function(e){var t=this;t.observer=t.game.world.find("observer"),t.gameObject.opt=e,t.gameObject.x=e.from.x,t.gameObject.y=e.from.y,t.gameObject.rotation=e.rot,t._live=t.game.time.now+t._liveTime,t.game.storage.get("mutesound")||e.snd.play()};var R=qc.defineBehaviour("qc.engine.BulletPool",qc.Behaviour,function(){this.ship=null,this.asteroidRoot=null,this.bulletPrefab=null,this.boomPrefab=null,this._clearTime=0},{sounds:qc.Serializer.AUDIOS,observer:qc.Serializer.NODE,ship:qc.Serializer.NODE,gnum:qc.Serializer.NODE,asteroidRoot:qc.Serializer.NODE,ufoRoot:qc.Serializer.NODE,bulletPrefab:qc.Serializer.PREFAB,ufo_explodePrefab:qc.Serializer.PREFAB,boomPrefab:qc.Serializer.PREFAB});R.prototype.addBoom=function(e){var t=this;if(!t.game.storage.get("mutesound")){var n=[.2,.5,.75,1],r=t.game.add.sound();r.destroyWhenStop=!0,r.audio=t.sounds[0],r.loop=!1,r.volume=n[e-1],r.play()}},R.prototype.addHit=function(e){var t=this;if(!t.game.storage.get("mutesound")){var n=[.1,.2,.2,.2],r=t.game.add.sound();r.destroyWhenStop=!0,r.audio=t.sounds[1],r.loop=!1,r.volume=n[e-1],r.play()}},R.prototype.add=function(e){var t=this;for(var n in t.gameObject.children){var r=t.gameObject.children[n];if(r.visible===!1){r.visible=!0,r.Bullet.init(e);return}}var i=t.game.add.clone(t.bulletPrefab,t.gameObject);i.Bullet.init(e)},R.prototype.update=function(){var e=this,t,n,r,i;if(e.observer.HUD.isPause)return;for(var s in e.gameObject.children){var o=e.gameObject.children[s];if(o.visible===!0){i=o.width/2;if(o.opt.targ.indexOf("aster")!==-1)for(var u=0,a=e.asteroidRoot.children.length;u<a;++u){t=e.asteroidRoot.children[u];if(t.Asteroid.type==="ast"&&t.visible){n=e.game.math.distance(t.x,t.y,o.x,o.y);if(n<t.Asteroid.radius+i){o.visible=!1,e.addHit(t.Asteroid.size),r=e.game.add.clone(e.boomPrefab),r.x=o.x,r.y=o.y,t.Asteroid.hp-=o.opt.dmg,t.Asteroid.hp<1&&(o.opt.isPlayer&&(e.observer.HUD.addScore(t.Asteroid.score),e.ship.ShipCtr.activateFireRate()),e.asteroidRoot.AsteroidPool.remove(t),e.addBoom(t.Asteroid.size));return}}}if(o.opt.targ.indexOf("ufo")!==-1)for(var f in e.ufoRoot.children){t=e.ufoRoot.children[f];if(t.visible){n=e.game.math.distance(t.x,t.y,o.x,o.y);if(n<t.width/2){o.visible=!1,e.ship.ShipCtr.activateFireRate(),e.observer.HUD.addScore(e.ufoRoot.UfoPool.score),e.ufoRoot.UfoPool.remove(t),e.addBoom(3),e.addHit(3),r=e.game.add.clone(e.ufo_explodePrefab),r.x=t.x,r.y=t.y;return}}}o.opt.targ.indexOf("gnum")!==-1&&e.gnum.Gnum.isActive&&(n=e.game.math.distance(e.gnum.x,e.gnum.y,o.x,o.y),n<e.gnum.width/2&&e.gnum.Gnum.teleport());if(o.opt.targ.indexOf("player")!==-1&&e.ship.visible&&e.ship._untouchable===!1){n=e.game.math.distance(e.ship.x,e.ship.y,o.x,o.y);if(n<e.ship.width/2){o.visible=!1,e.observer.HUD.addLives(-1),e.addBoom(3);return}}var l=e.game.time.deltaTime/1e3;o.x+=o.opt.dir.x*o.opt.speed*l,o.y+=o.opt.dir.y*o.opt.speed*l;if(o.x<0||o.x>e.game.width||o.y<0||o.y>e.game.height)o.visible=!1}}};var U=qc.defineBehaviour("qc.engine.Cursor",qc.Behaviour,function(){},{});U.prototype.update=function(){var e=this;e.gameObject.x=e.game.input.mouse.input.cursorPosition.x,e.gameObject.y=e.game.input.mouse.input.cursorPosition.y};var z=qc.defineBehaviour("qc.engine.Debug",qc.Behaviour,function(){},{});z.prototype.show=function(e){var t=this,n="";for(var r in e)n+=r+": "+e[r]+"\n";t.gameObject.text=n};var W=qc.defineBehaviour("qc.engine.Gnum",qc.Behaviour,function(){this._target=!1,this._seekTimeout=2e4,this._nextSeek=0,this._speed=130,this._mileage=0,this.spawnDist=500,this.vTmp=new Y(0,0),this.vDir=new Y(0,0),this.vDiff=new Y(0,0),this.vAvoid=new Y(0,0)},{sounds:qc.Serializer.AUDIOS,observer:qc.Serializer.NODE,asters:qc.Serializer.NODE,ship:qc.Serializer.NODE,teleport_fx:qc.Serializer.NODE});W.prototype.awake=function(){var e=this;e.isAwake=!0,e.radius=e.gameObject.width/2,e._sndEngine=e.game.add.sound(),e._sndEngine.destroyWhenStop=!1,e._sndEngine.audio=e.sounds[0],e._sndEngine.loop=!0,e._sndEngine.volume=.5,e._sndTeleport=e.game.add.sound(),e._sndTeleport.destroyWhenStop=!1,e._sndTeleport.audio=e.sounds[1],e._sndTeleport.false=!0,e._sndTeleport.volume=.3,this.teleport(!1)},W.prototype.teleport=function(e){var t=this,n,r;e=e!==!1?!0:!1,e&&(t._sndTeleport.play(),t.teleport_fx.Animator.play(),t.teleport_fx.x=t.gameObject.x,t.teleport_fx.y=t.gameObject.y);var i=Math.random()<.5?-1:1,s=Math.random()<.5?-1:1,o=t.spawnDist;Math.random()<.5?(n=i==1?-o:t.game.width+o,r=Math.floor(Math.random()*t.game.height/4)):(r=s==1?-o:t.game.height+o,n=Math.floor(Math.random()*t.game.width/4)),t.gameObject.x=n,t.gameObject.y=r;var u=new Y(t.game.width/2,t.game.height/2),a=new Y(n,r);t._mileage=0,t.wayLen=u.distance(a),t.sndEngineStep=1/this.wayLen,t.isActive=!1,t._sndEngine.stop(),t._nextSeek=t.game.time.now+t._seekTimeout},W.prototype.update=function(){var e=this,t=e.gameObject;if(e.isAwake!==!0||e.observer.HUD.isPause)return;!e.isActive&&e.game.time.now>e._nextSeek&&(e._target=e.asters.AsteroidPool.getNearGem(t),e._nextSeek=e.game.time.now+e._seekTimeout,e._target&&(e.isActive=!0,e._sndEngine.play(),e._sndEngine.volume=.01));if(e.isActive){if(!e._target){e.teleport();return}if(e._target.visible==0){e._target=e.asters.AsteroidPool.getNearGem(t);return}var n=e.game.time.deltaTime/1e3;e.vDir.x=e._target.x-t.x,e.vDir.y=e._target.y-t.y,e.vDir.normalize();var r=e.radius*4;e.vAvoid.x=e.vAvoid.y=0;var i,s,o,u,a=0;for(var f=0,l=e.asters.children.length;f<l;++f)i=e.asters.children[f],i.Asteroid.type=="ast"&&i.visible&&(s=t.x-i.x,o=t.y-i.y,u=Math.floor(Math.sqrt(s*s+o*o)),u>0&&u<=r&&(a++,e.vDiff.x=s,e.vDiff.y=o,e.vDiff.normalize(),e.vDiff.x/=u,e.vDiff.y/=u,e.vAvoid.x+=e.vDiff.x,e.vAvoid.y+=e.vDiff.y));s=t.x-e.ship.x,o=t.y-e.ship.y,u=Math.floor(Math.sqrt(s*s+o*o)),u>0&&u<=r&&(a++,e.vDiff.x=s,e.vDiff.y=o,e.vDiff.normalize(),e.vDiff.x/=u,e.vDiff.y/=u,e.vAvoid.x+=e.vDiff.x,e.vAvoid.y+=e.vDiff.y),a>0&&(e.vAvoid.x/=a,e.vAvoid.y/=a,e.vAvoid.normalize()),t.x+=(e.vDir.x*e._speed+e.vAvoid.x*50)*n,t.y+=(e.vDir.y*e._speed+e.vAvoid.y*50)*n,e.vTmp.x=e.vDir.x+e.vAvoid.x,e.vTmp.y=e.vDir.y+e.vAvoid.y,t.rotation=e.vTmp.angle(),e._mileage+=e._speed*n,e._mileage<e.wayLen&&(e._sndEngine.volume+=e.sndEngineStep)}};var X=qc.defineBehaviour("qc.engine.HUD",qc.Behaviour,function(){this._wave=0,this._score=0,this._money=0,this._lives=0,this._optMuteSound=!1},{ufoRoot:qc.Serializer.NODE,asteroidRoot:qc.Serializer.NODE,ship:qc.Serializer.NODE,crash:qc.Serializer.NODE,fldScore:qc.Serializer.NODE,fldLives:qc.Serializer.NODE,fldWave:qc.Serializer.NODE,fldMoney:qc.Serializer.NODE,dlgGameOver:qc.Serializer.NODE,dlgShop:qc.Serializer.NODE,dlgPause:qc.Serializer.NODE});X.prototype.awake=function(){var t=this;t._optMuteSound=e.localStorage.getItem("muteSound")||!1,t.restart()},X.prototype.addScore=function(e){var t=this;t._score+=e,t.fldScore.text=qc.lc_get("hud_score")+t._score},X.prototype.addMoney=function(e){var t=this;t._money+=e,t.fldMoney.text=qc.lc_get("hud_money")+t._money},X.prototype.setWave=function(e){var t=this;t.fldWave.text=qc.lc_get("hud_wave")+e,t.ufoRoot.UfoPool.recalcTimeout(e)},X.prototype.addLives=function(e){var t=this;t._lives+=e;if(e<0){t.crash.reset(),t.crash.x=t.ship.x,t.crash.y=t.ship.y,t.crash.start();if(t._lives<0)t.ship.ShipCtr.die(),t.dlgGameOver.visible=!0,t.dlgGameOver.x=t.game.width/2-t.dlgGameOver.width/2,t.dlgGameOver.y=t.game.height/2-t.dlgGameOver.height/2;else{t.ship.x=t.game.width/2,t.ship.y=t.game.height/2;var n=t.ship.getScript("qc.arcade.RigidBody");n.velocity.x=n.velocity.y=0,t.ship.addScript("qc.engine.Buf_Untochable")}}t.fldLives.text=qc.lc_get("hud_lives")+t._lives},X.prototype.restart=function(){var e=this;e.isPause=!1,e.dlgGameOver.visible=!1,e.dlgShop.visible=!1,e.dlgPause.visible=!1,e._lives=1,e.fldLives.text=qc.lc_get("hud_lives")+e._lives,e.fldWave.text=qc.lc_get("hud_wave")+e._wave,e._score=0,e.fldScore.text=qc.lc_get("hud_score")+e._score,e._money=0,e.fldMoney.text=qc.lc_get("hud_money")+e._money,e.ship.visible=!0,e.ufoRoot.UfoPool._ufoTime=e.game.time.now+e.ufoRoot.UfoPool._ufoTimeout,e.ship.x=e.game.width/2,e.ship.y=e.game.height/2;var t=e.ship.getScript("qc.arcade.RigidBody");t.velocity.x=t.velocity.y=0,e.ship.addScript("qc.engine.Buf_Untochable"),e.ship.ShipCtr.removeSkills(),e.asteroidRoot.AsteroidPool.removeAll(),e.asteroidRoot.AsteroidPool._wave=e._wave,e.ufoRoot.UfoPool.recalcTimeout(1),e.ufoRoot.UfoPool.removeAll()},X.prototype.update=function(){var e=this,t,n;!e.isKeyPause&&e.game.input.isKeyDown(qc.Keyboard.P)&&(t=e.isPause||!1,e.isPause=!t,e.dlgPause.visible=e.isPause,e.isKeyPause=!0,setTimeout(function(){e.isKeyPause=!1},500)),e._lives>-1&&!e.isKeyShop&&e.game.input.isKeyDown(qc.Keyboard.CONTROL)&&(n=!e.dlgShop.visible,e.isPause=n,e.dlgShop.visible=n,n&&(e.dlgShop.x=e.game.width/2-e.dlgShop.width/2,e.dlgShop.y=e.game.height/2-e.dlgShop.height/2,e.dlgShop._findByName("itm_ship").Btn_ShopItem.resetButtons()),e.isKeyShop=!0,setTimeout(function(){e.isKeyShop=!1},500))};var V=qc.defineBehaviour("qc.engine.Locales",qc.Behaviour,function(){},{data:qc.Serializer.EXCELASSET});V.prototype.awake=function(){var e=this;qc.lang=this.game.storage.get("lang")||"en",qc.locales.en={},qc.locales.ru={};var t=e.data.findSheet("locales");t.rows.forEach(function(e){qc.locales.en[e.key]=e.en,qc.locales.ru[e.key]=e.ru})};var $=qc.defineBehaviour("qc.engine.Observer_menu",qc.Behaviour,function(){this._wave=0},{wopt:qc.Serializer.NODE,ufos:qc.Serializer.NODE,gnum:qc.Serializer.NODE,asters:qc.Serializer.NODE});$.prototype.awake=function(){var e=this;e.restart()},$.prototype.restart=function(){var e=this;e.gnum.Gnum._seekTimeout=1e4,e.ufos.UfoPool._ufoTimeout=25e3,e.ufos.UfoPool._ufoTime=0,e.asters.AsteroidPool.removeAll(),e.asters.AsteroidPool._wave=e._wave,e.ufos.UfoPool.removeAll(),e.wopt.visible=!1},$.prototype.setWave=function(e){this._wave=0};var J=qc.defineBehaviour("qc.demo.ShipCtr",qc.Behaviour,function(){this.bullets=null,this._fireTime=0,this._fireTimeoutBase=500,this._fireTimeout=500,this._accelDec={x:5,y:5,lim:10},this._bulletSpeed=800,this._bulletDamage=1,this.isSeamlessWorld=!1,this._isFly=!1,this.gameObject._untouchable=!1,this.bonus={firerate:0},this.skills={life:{cost:0,value:0,up:function(e){return this.cost<=e?(this.value++,!0):!1}},teleport:{level:0,max_level:5,base:30,value:0,step:-5,cost:0,up:function(e){return this.cost<=e&&this.level<this.max_level?(this.level++,this.value=this.base+this.level*this.step,!0):!1},lget:function(){return this.level===0?"---":this.base+this.level*this.step},nget:function(){return this.level+1>this.max_level?"---":this.base+(this.level+1)*this.step},reset:function(){this.level=0,this.value=0}},firerate:{level:0,points:0,max_level:5,base:0,value:0,step:50,cost:0,timeout:0,base_timeout:5e3,up:function(e){return this.cost<=e&&this.level<this.max_level?(this.level++,this.value=this.level*this.step,!0):!1},lget:function(){return this.level===0?"---":this.level*20},nget:function(){return this.level+1>this.max_level?"---":(this.level+1)*20},reset:function(){this.level=0,this.value=0,this.points=0},current:function(){return this.points*this.step}},cloaker:{level:0,max_level:5,base:0,value:0,step:5,cost:0,up:function(e){return this.cost<=e&&this.level<this.max_level?(this.level++,this.value=this.level*this.step,!0):!1},lget:function(){return this.level===0?"50":50-this.level*this.step},nget:function(){return this.level+1>this.max_level?"---":50-(this.level+1)*this.step},reset:function(){this.level=0,this.value=0}},resonator:{level:0,max_level:4,base:0,value:0,step:1,cost:0,up:function(e){return this.cost<=e&&this.level<this.max_level?(this.level++,this.value+=this.step,!0):!1},lget:function(){return this.level===0?"---":this.level},nget:function(){return this.level+1>this.max_level?"---":this.level+1},reset:function(){this.level=0,this.value=0}},radar:{level:0,max_level:3,base:0,value:0,step:1,cost:0,up:function(e){return this.cost<=e&&this.level<this.max_level?(this.level++,this.value+=this.step,!0):!1},lget:function(){return this.level===0?"---":this.level},nget:function(){return this.level+1>this.max_level?"---":this.level+1},reset:function(){this.level=0,this.value=0}}}},{observer:qc.Serializer.NODE,sounds:qc.Serializer.AUDIOS,bullets:qc.Serializer.NODE,bg:qc.Serializer.NODE,asters:qc.Serializer.NODE,ico_teleport:qc.Serializer.NODE,ico_frate:qc.Serializer.NODE,ico_resonator:qc.Serializer.NODE,ico_radar:qc.Serializer.NODE});J.prototype.awake=function(){var e=this,t=e.game.input;this.rbody=this.getScript("qc.arcade.RigidBody"),this.rbody.angularAcceleration=0,e._isFly=!1,e.control_type=e.game.storage.get("control_type"),e.radius=e.gameObject.width/2,e.bg_reserve_x=e.bg.width-e.game.width,e.bg_reserve_y=e.bg.height-e.game.height,this.addListener(t.onPointerUp,e.onPointerUp,e),e._sndEngine=e.game.add.sound(),e._sndEngine.destroyWhenStop=!1,e._sndEngine.audio=e.sounds[0],e._sndEngine.loop=!0,e._sndEngine.volume=.3,e._sndShoot=e.game.add.sound(),e._sndShoot.destroyWhenStop=!1,e._sndShoot.audio=e.sounds[1],e._sndShoot.loop=!1,e._sndShoot.volume=.6,e._sndTeleport=e.game.add.sound(),e._sndTeleport.destroyWhenStop=!1,e._sndTeleport.audio=e.sounds[2],e._sndTeleport.false=!0,e._sndTeleport.volume=.3,e._drag=e.game.storage.get("drag")||0;switch(e._drag){case 1:this.getScript("qc.arcade.RigidBody").drag.set(150,150);break;case 2:this.getScript("qc.arcade.RigidBody").drag.set(0,0);break;default:this.getScript("qc.arcade.RigidBody").drag.set(600,600)}e.game.storage.get("seamless")&&(this.isSeamlessWorld=!0,this.hideRight=this.game.width+16,this.hideBottom=this.game.height+16,this.getScript("qc.arcade.RigidBody").collideWorldBounds=!1)},J.prototype.update=function(){var e=this,t=this.gameObject,n=e.game.time.deltaTime/1e3,r=!1,i=!1,s=null,o=!1;e.rbody.moves=!e.observer.HUD.isPause;if(e.observer.HUD.isPause)return;e.control_type=="mouse"?(e.game.input.mouse.isMouseDown(qc.Mouse.BUTTON_RIGHT)&&(i=!0),e.game.input.mouse.isMouseDown(qc.Mouse.BUTTON_MIDDLE)&&(o=!0),i=o?o:i):(e.game.input.isKeyDown(qc.Keyboard.A)?(r=!0,s=3):e.game.input.isKeyDown(qc.Keyboard.D)&&(r=!0,s=0),e.game.input.isKeyDown(qc.Keyboard.W)?(r=!0,s==null?s=-1.5:s==0?s=-0.75:s=-2.25):e.game.input.isKeyDown(qc.Keyboard.S)&&(r=!0,s==null?s=1.5:s==0?s=.75:s=2.25)),t.rotation=e.rbody.angleBetween(e.game.input.cursorPosition);if(i){var u=o?-250:250;e.rbody.velocityFromRotation(t.rotation,u,e.rbody.acceleration),e._isFly||(e._isFly=!0,t.playAnimation("fly"),e.game.storage.get("mutesound")||e._sndEngine.play())}else r&&(e.rbody.velocityFromRotation(s,250,e.rbody.acceleration),e._isFly||(e._isFly=!0,t.playAnimation("fly"),e.game.storage.get("mutesound")||e._sndEngine.play()));!i&&!r&&(e.rbody.acceleration.x!==0||e.rbody.acceleration.y!==0)&&(e._isFly&&(e._isFly=!1,e._sndEngine.stop(),t.stop(),t.frame="ship.png"),e.rbody.acceleration.set(0,0));if(e.rbody.velocity.x!==0||e.rbody.velocity.y!==0)e.isSeamlessWorld&&(t.x<-16?t.x=e.game.width+16:t.x>e.hideRight&&(t.x=-16),t.y<-16?t.y=e.game.height+16:t.y>e.hideBottom&&(t.y=-16)),e.bg.x+=-e.rbody.velocity.x*n/10,e.bg.y+=-e.rbody.velocity.y*n/10,e.bg.x>0?e.bg.x=0:e.bg.x<-e.bg_reserve_x&&(e.bg.x=-e.bg_reserve_x),e.bg.y>0?e.bg.y=0:e.bg.y<-e.bg_reserve_y&&(e.bg.y=-e.bg_reserve_y);e.game.input.mouse.isMouseDown(qc.Mouse.BUTTON_LEFT)&&e.fire(),!e.isKeyTeleport&&e.game.input.isKeyDown(qc.Keyboard.SPACEBAR)&&e.skills.teleport.level>0&&(t.Buf_Teleport.apply(e.bg)?(e._sndTeleport.play(),e.skills.resonator.level>0&&(t.Buf_Resonator.activate(),t.Buf_Resonator.apply())):e.skills.resonator.level>0&&t.Buf_Resonator.apply(),e.isKeyTeleport=!0,setTimeout(function(){e.isKeyTeleport=!1},500))},J.prototype.onPointerUp=function(e,t,n){var r=this,i=r.game.input,s=i.getPointer(e);if(s.isMouse&&s.id===qc.Mouse.BUTTON_LEFT){var o=this.getScript("qc.arcade.RigidBody");o.acceleration.x=o.velocity.x,o.acceleration.y=o.velocity.y,Math.abs(o.velocity.x)>Math.abs(o.velocity.y)?(r._accelDec.x=r._accelDec.lim,r._accelDec.y=r._accelDec.lim*Math.abs(o.velocity.y/o.velocity.x)):(r._accelDec.y=r._accelDec.lim,r._accelDec.x=r._accelDec.lim*Math.abs(o.velocity.x/o.velocity.y))}},J.prototype.fire=function(){var e=this,t=e.bonus.firerate,n=e.skills.firerate;if(e.game.time.now-e._fireTime<e._fireTimeout)return;n.timeout>0?e._fireTimeout=e._fireTimeoutBase-n.current()-t:e._fireTimeout=e._fireTimeoutBase,e._fireTime=e.game.time.now,e.bullets.BulletPool.add({isPlayer:!0,from:e.gameObject,snd:e._sndShoot,targ:["aster","ufo","gnum"],dmg:e._bulletDamage,rot:e.gameObject.rotation,dir:{x:Math.cos(e.gameObject.rotation),y:Math.sin(e.gameObject.rotation)},speed:e._bulletSpeed})},J.prototype.die=function(){var e=this;e.gameObject.visible=!1,e._isFly&&(e._sndEngine.stop(),e.gameObject.stop(),e.gameObject.frame="ship.png")},J.prototype.saveDirection=function(){var e=this,t=e.gameObject,n=Math.sqrt(t.x*t.x+t.y*t.y);e._dir.x=t.x/n,e._dir.y=t.y/n,e._isNeedSaveDir=!1},J.prototype.removeSkills=function(){var e=this,t=e.gameObject;t.Buf_Teleport&&t.removeScript(t.Buf_Teleport),e.skills.teleport.reset(),e.ico_teleport.visible=!1,t.Buf_Firerate&&t.Buf_Firerate.remove(),e.ico_frate.visible=!1,t.Buf_Resonator&&t.Buf_Resonator.remove(),e.ico_resonator.visible=!1,t.Buf_Radar&&t.Buf_Radar.remove(),e.ico_radar.visible=!1,e.skills.cloaker.reset()},J.prototype.pause=function(e){var t=self.ship.getScript("qc.arcade.RigidBody");t.moves=!e},J.prototype.activateFireRate=function(){var e=this,t=e.skills.firerate;t.level>0&&(this.gameObject.Buf_Firerate.advance(1),t.timeout=t.base_timeout)};var K=qc.defineBehaviour("qc.engine.SoundPool",qc.Behaviour,function(){},{list:qc.Serializer.AUDIOS}),Q=qc.defineBehaviour("qc.engine.Stars",qc.Behaviour,function(){this._timeout=0},{starPref:qc.Serializer.PREFAB});Q.prototype.awake=function(){var e=this;e._center={x:e.game.width/2,y:e.game.height/2},e.scaleStep=1e3},Q.prototype.spawn=function(){var e=this,t=!1;for(var n=0,r=e.gameObject.children.length;n<r;++n){var i=e.gameObject.children[n];i.visible===!1&&(i.visible=!0,t=i)}t||(t=e.game.add.clone(e.starPref,e.gameObject));var s=Math.random()*360;return t.rotation=s,t._dir_x=Math.cos(s),t._dir_y=Math.sin(s),t._speed=1,t.scaleX=t.scaleY=.1,t.x=e._center.x,t.y=e._center.y,t.visible=!0,t},Q.prototype.update=function(){var e=this;e._timeout-=this.game.time.deltaTime,e._timeout<0&&(e._timeout=100,e.spawn());for(var t=0,n=e.gameObject.children.length;t<n;++t)if(e.gameObject.children[t].visible===!0){var r=e.gameObject.children[t],i=e.game.time.deltaTime/1e3;r._speed+=r._speed*i,r.x+=r._dir_x*r._speed*i,r.y+=r._dir_y*r._speed*i,r.scaleX=r.scaleY+=r._speed/2e4,r.rotation+=.01;if(r.x<0||r.x>e.game.width||r.y<0||r.y>e.game.height)r.visible=!1}};var G=qc.defineBehaviour("qc.engine.UfoPool",qc.Behaviour,function(){this.score=200,this._ufoTimeout=4e4,this._ufoTime=this.game.time.now+this._ufoTimeout,this._speed=150,this._bulletSpeed=300,this._bulletDamage=4,this.spawnDist=500,this.wayLen=this.spawnDist*2+this.game.width,this.sndEngineStart=.001,this.sndEngineStep=(.2-this.sndEngineStart)/this.wayLen/2,this._firstShootMin=1,this._firstShootMax=3,this._cooldown=2e3,this._chanceShootToPlayer=50},{observer:qc.Serializer.NODE,asters:qc.Serializer.NODE,bullets:qc.Serializer.NODE,ship:qc.Serializer.NODE,ufoPrefab:qc.Serializer.PREFAB,sounds:qc.Serializer.AUDIOS});G.prototype.awake=function(){var e=this;e.isAwake=!0,!e.observer.HUD&&e.observer.Observer_menu&&(e.observer.HUD=e.observer.Observer_menu)},G.prototype.recalcTimeout=function(e){var t=this;e==1?t._ufoTimeout=4e4:e==2?t._ufoTimeout=35e3:e==3&&(t._ufoTimeout=35e3),t._ufoTime=t.game.time.now+t._ufoTimeout},G.prototype.spawn=function(){var e=this,t,n,r,i,s={},o=1,u=0,a=[];for(t=0;t<o;t++){r=Math.random()<.5?-1:1,i=Math.random()<.5?-1:1;var f=e.spawnDist;Math.random()<.5?(s.x=r==1?-f:e.game.width+f,s.ex=r==1?e.game.width+f:-f,s.y=Math.floor(Math.random()*e.game.height/4),s.ey=e.game.height-s.y):(s.y=i==1?-f:e.game.height+f,s.ey=i==1?e.game.height+f:-f,s.x=Math.floor(Math.random()*e.game.width/4),s.ex=e.game.width-s.x),s.rot=e.game.math.angleBetween(s.x,s.y,s.ex,s.ey),s.dir={x:Math.cos(s.rot),y:Math.sin(s.rot)},a.push(s)}for(t in e.gameObject.children){n=e.gameObject.children[t];if(n.visible===!1){e.init(n,a[u]),u++;if(u===o)return}}for(t=u;t<o;t++)n=e.game.add.clone(e.ufoPrefab,e.gameObject),e.add(n,a[t])},G.prototype.add=function(e,t){var n=this;e.visible=!0,e.x=t.x,e.y=t.y,e.rotation=t.rot,e._dir=t.dir,e._sndEngine=n.game.add.sound(),e._sndEngine.destroyWhenStop=!1,e._sndEngine.audio=n.sounds[0],e._sndEngine.loop=!0,e._sndEngine.volume=n.sndEngineStart,n.game.storage.get("mutesound")||e._sndEngine.play(),e._sndShoot=n.game.add.sound(),e._sndShoot.destroyWhenStop=!1,e._sndShoot.audio=n.sounds[1],e._sndShoot.loop=!1,e._sndShoot.volume=1,e.cooldownTimeout=n._cooldown,e.mileage=0},G.prototype.init=function(e,t){var n=this;e.cooldownTimeout=n._cooldown,e.mileage=0,e._sndEngine.volume=n.sndEngineStart,e.visible=!0,e.x=t.x,e.y=t.y,e.rotation=t.rot,e._dir=t.dir,n.game.storage.get("mutesound")||e._sndEngine.play()},G.prototype.remove=function(e){e.visible=!1,e._sndEngine.stop()},G.prototype.removeAll=function(){var e=this,t,n;for(t in e.gameObject.children)n=e.gameObject.children[t],n.visible===!0&&(n.visible=!1,n._sndEngine.stop())},G.prototype.shoot=function(e){var t=this,n={from:e,snd:e._sndShoot,speed:t._bulletSpeed,dmg:t._bulletDamage};e.cooldownTimeout=t._cooldown;if(t.ship.visible&&Math.random()*100<t._chanceShootToPlayer-t.ship.ShipCtr.skills.cloaker.value)n.targ=["player"],n.rot=t.game.math.angleBetween(e.x,e.y,t.ship.x,t.ship.y),n.dir={x:Math.cos(n.rot),y:Math.sin(n.rot)};else{n.targ=["aster"];var r=t.asters.AsteroidPool.getNear(e,4);r=r||t.asters.AsteroidPool.getNear(e,3),r=r||t.asters.AsteroidPool.getNear(e,2),r=r||t.asters.AsteroidPool.getNear(e,1),r=r||{x:t.ship.x,y:t.ship.y},n.rot=t.game.math.angleBetween(e.x,e.y,r.x,r.y),n.dir={x:Math.cos(n.rot),y:Math.sin(n.rot)}}t.bullets.BulletPool.add(n)},G.prototype.update=function(){var e=this,t,n;if(e.isAwake!==!0||e.observer.HUD.isPause)return;e.game.time.now>e._ufoTime&&(e._ufoTime=e.game.time.now+e._ufoTimeout,e.spawn());for(var r in e.gameObject.children)if(e.gameObject.children[r].visible===!0){t=e.gameObject.children[r],n=e.game.time.deltaTime/1e3,t.x+=t._dir.x*e._speed*n,t.y+=t._dir.y*e._speed*n,t.mileage+=e._speed*n,t.mileage<e.wayLen/2?t._sndEngine.volume+=e.sndEngineStep:t._sndEngine.volume-=e.sndEngineStep;if(t.mileage>e.wayLen){e.remove(t);continue}t.x>0&&t.y>0&&t.x<e.game.width&&t.y<e.game.height&&(t.cooldownTimeout-=e.game.time.deltaTime,t.cooldownTimeout<0&&e.shoot(t));if(e.ship.visible===!0&&e.ship._untouchable===!1){var i=e.game.math.distance(t.x,t.y,e.ship.x,e.ship.y);i<e.ship.ShipCtr.radius+t.width/2&&(e.observer.HUD.addLives(-1),e.asters.AsteroidPool.addBoom())}}},Y.prototype.mul=function(e){return this.x*=e,this.y*=e,this},Y.prototype.scale=Y.prototype.mul,Y.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},Y.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},Y.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Y.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},Y.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);return e&&(this.x/=e,this.y/=e),this},Y.prototype.dotProd=function(e){return this.x*e.x+this.y*e.y},Y.prototype.rotate=function(e){return this.x=this.x*Math.cos(e)-this.y*Math.sin(e),this.y=this.y*Math.cos(e)+this.x*Math.sin(e),this},Y.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},Y.prototype.toString=function(){return"x = "+this.x+", y = "+this.y},Y.prototype.copy=function(){return new Y(this.x,this.y)},Y.prototype.distance=function(e){return e.copy().sub(this).len()},Y.prototype.angleBetween=function(e){return e.angle()-this.angle()},Y.prototype.angle=function(){return Math.atan2(this.y,this.x)},Y.lineIntersectsCircle=function(e,t,n,r,i){var s=n-e.x,o=r-e.y,u=Math.sqrt(s*s+o*o);s=n-t.x,o=n-t.y;var a=Math.sqrt(s*s+o*o);return u<=i||a<=i?!0:!1};var Z=qc.defineBehaviour("qc.engine.Btn_ReturnToMenu",qc.Behaviour,function(){},{});Z.prototype.onClick=function(){var e=this;e.game.scene.load("mmenu")};var et=qc.defineBehaviour("qc.engine.Btn_TryAgain",qc.Behaviour,function(){},{observer:qc.Serializer.NODE});et.prototype.onClick=function(){var e=this;e.observer.HUD.restart()}}).call(this,this,Object)